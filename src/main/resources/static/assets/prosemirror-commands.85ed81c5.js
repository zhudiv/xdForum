import{f as U,l as T,r as E,c as h,R as N,b as P}from"./prosemirror-transform.ac9e639a.js";import{a as M,F as I}from"./prosemirror-model.b56130c8.js";import{S as V,A as R,N as m,T as O}from"./prosemirror-state.334938da.js";function K(e,r){return e.selection.empty?!1:(r&&r(e.tr.deleteSelection().scrollIntoView()),!0)}function X(e,r,t){var n=e.selection,o=n.$cursor;if(!o||(t?!t.endOfTextblock("backward",e):o.parentOffset>0))return!1;var l=q(o);if(!l){var a=o.blockRange(),f=a&&T(a);return f==null?!1:(r&&r(e.tr.lift(a,f).scrollIntoView()),!0)}var i=l.nodeBefore;if(!i.type.spec.isolating&&J(e,l,r))return!0;if(o.parent.content.size==0&&(A(i,"end")||m.isSelectable(i))){var c=E(e.doc,o.before(),o.after(),M.empty);if(c.slice.size<c.to-c.from){if(r){var s=e.tr.step(c);s.setSelection(A(i,"end")?V.findFrom(s.doc.resolve(s.mapping.map(l.pos,-1)),-1):m.create(s.doc,l.pos-i.nodeSize)),r(s.scrollIntoView())}return!0}}return i.isAtom&&l.depth==o.depth-1?(r&&r(e.tr.delete(l.pos-i.nodeSize,l.pos).scrollIntoView()),!0):!1}function A(e,r,t){for(;e;e=r=="start"?e.firstChild:e.lastChild){if(e.isTextblock)return!0;if(t&&e.childCount!=1)return!1}return!1}function Y(e,r,t){var n=e.selection,o=n.$head,l=n.empty,a=o;if(!l)return!1;if(o.parent.isTextblock){if(t?!t.endOfTextblock("backward",e):o.parentOffset>0)return!1;a=q(o)}var f=a&&a.nodeBefore;return!f||!m.isSelectable(f)?!1:(r&&r(e.tr.setSelection(m.create(e.doc,a.pos-f.nodeSize)).scrollIntoView()),!0)}function q(e){if(!e.parent.type.spec.isolating)for(var r=e.depth-1;r>=0;r--){if(e.index(r)>0)return e.doc.resolve(e.before(r+1));if(e.node(r).type.spec.isolating)break}return null}function Z(e,r,t){var n=e.selection,o=n.$cursor;if(!o||(t?!t.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size))return!1;var l=H(o);if(!l)return!1;var a=l.nodeAfter;if(J(e,l,r))return!0;if(o.parent.content.size==0&&(A(a,"start")||m.isSelectable(a))){var f=E(e.doc,o.before(),o.after(),M.empty);if(f.slice.size<f.to-f.from){if(r){var i=e.tr.step(f);i.setSelection(A(a,"start")?V.findFrom(i.doc.resolve(i.mapping.map(l.pos)),1):m.create(i.doc,i.mapping.map(l.pos))),r(i.scrollIntoView())}return!0}}return a.isAtom&&l.depth==o.depth-1?(r&&r(e.tr.delete(l.pos,l.pos+a.nodeSize).scrollIntoView()),!0):!1}function _(e,r,t){var n=e.selection,o=n.$head,l=n.empty,a=o;if(!l)return!1;if(o.parent.isTextblock){if(t?!t.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size)return!1;a=H(o)}var f=a&&a.nodeAfter;return!f||!m.isSelectable(f)?!1:(r&&r(e.tr.setSelection(m.create(e.doc,a.pos)).scrollIntoView()),!0)}function H(e){if(!e.parent.type.spec.isolating)for(var r=e.depth-1;r>=0;r--){var t=e.node(r);if(e.index(r)+1<t.childCount)return e.doc.resolve(e.after(r+1));if(t.type.spec.isolating)break}return null}function $(e,r){var t=e.selection,n=t.$head,o=t.$anchor;return!n.parent.type.spec.code||!n.sameParent(o)?!1:(r&&r(e.tr.insertText(`
`).scrollIntoView()),!0)}function F(e){for(var r=0;r<e.edgeCount;r++){var t=e.edge(r),n=t.type;if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function ee(e,r){var t=e.selection,n=t.$head,o=t.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o))return!1;var l=n.node(-1),a=n.indexAfter(-1),f=F(l.contentMatchAt(a));if(!l.canReplaceWith(a,a,f))return!1;if(r){var i=n.after(),c=e.tr.replaceWith(i,i,f.createAndFill());c.setSelection(V.near(c.doc.resolve(i),1)),r(c.scrollIntoView())}return!0}function re(e,r){var t=e.selection,n=t.$from,o=t.$to;if(t instanceof R||n.parent.inlineContent||o.parent.inlineContent)return!1;var l=F(o.parent.contentMatchAt(o.indexAfter()));if(!l||!l.isTextblock)return!1;if(r){var a=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos,f=e.tr.insert(a,l.createAndFill());f.setSelection(O.create(f.doc,a+1)),r(f.scrollIntoView())}return!0}function ne(e,r){var t=e.selection,n=t.$cursor;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){var o=n.before();if(h(e.doc,o))return r&&r(e.tr.split(o).scrollIntoView()),!0}var l=n.blockRange(),a=l&&T(l);return a==null?!1:(r&&r(e.tr.lift(l,a).scrollIntoView()),!0)}function oe(e,r){var t=e.selection,n=t.$from,o=t.$to;if(e.selection instanceof m&&e.selection.node.isBlock)return!n.parentOffset||!h(e.doc,n.pos)?!1:(r&&r(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.parent.isBlock)return!1;if(r){var l=o.parentOffset==o.parent.content.size,a=e.tr;(e.selection instanceof O||e.selection instanceof R)&&a.deleteSelection();var f=n.depth==0?null:F(n.node(-1).contentMatchAt(n.indexAfter(-1))),i=l&&f?[{type:f}]:null,c=h(a.doc,a.mapping.map(n.pos),1,i);if(!i&&!c&&h(a.doc,a.mapping.map(n.pos),1,f&&[{type:f}])&&(i=[{type:f}],c=!0),c&&(a.split(a.mapping.map(n.pos),1,i),!l&&!n.parentOffset&&n.parent.type!=f)){var s=a.mapping.map(n.before()),u=a.doc.resolve(s);n.node(-1).canReplaceWith(u.index(),u.index()+1,f)&&a.setNodeMarkup(a.mapping.map(n.before()),f)}r(a.scrollIntoView())}return!0}function te(e,r){return r&&r(e.tr.setSelection(new R(e.doc))),!0}function le(e,r,t){var n=r.nodeBefore,o=r.nodeAfter,l=r.index();return!n||!o||!n.type.compatibleContent(o.type)?!1:!n.content.size&&r.parent.canReplace(l-1,l)?(t&&t(e.tr.delete(r.pos-n.nodeSize,r.pos).scrollIntoView()),!0):!r.parent.canReplace(l,l+1)||!(o.isTextblock||P(e.doc,r.pos))?!1:(t&&t(e.tr.clearIncompatible(r.pos,n.type,n.contentMatchAt(n.childCount)).join(r.pos).scrollIntoView()),!0)}function J(e,r,t){var n=r.nodeBefore,o=r.nodeAfter,l,a;if(n.type.spec.isolating||o.type.spec.isolating)return!1;if(le(e,r,t))return!0;var f=r.parent.canReplace(r.index(),r.index()+1);if(f&&(l=(a=n.contentMatchAt(n.childCount)).findWrapping(o.type))&&a.matchType(l[0]||o.type).validEnd){if(t){for(var i=r.pos+o.nodeSize,c=I.empty,s=l.length-1;s>=0;s--)c=I.from(l[s].create(null,c));c=I.from(n.copy(c));var u=e.tr.step(new N(r.pos-1,i,r.pos,i,new M(c,1,0),l.length,!0)),B=i+2*l.length;P(u.doc,B)&&u.join(B),t(u.scrollIntoView())}return!0}var S=V.findFrom(r,1),k=S&&S.$from.blockRange(S.$to),y=k&&T(k);if(y!=null&&y>=r.depth)return t&&t(e.tr.lift(k,y).scrollIntoView()),!0;if(f&&A(o,"start",!0)&&A(n,"end")){for(var v=n,p=[];p.push(v),!v.isTextblock;)v=v.lastChild;for(var g=o,b=1;!g.isTextblock;g=g.firstChild)b++;if(v.canReplace(v.childCount,v.childCount,g.content)){if(t){for(var x=I.empty,w=p.length-1;w>=0;w--)x=I.from(p[w].copy(x));var C=e.tr.step(new N(r.pos-p.length,r.pos+o.nodeSize,r.pos+b,r.pos+o.nodeSize-b,new M(x,p.length,0),0,!0));t(C.scrollIntoView())}return!0}}return!1}function G(e){return function(r,t){for(var n=r.selection,o=e<0?n.$from:n.$to,l=o.depth;o.node(l).isInline;){if(!l)return!1;l--}return o.node(l).isTextblock?(t&&t(r.tr.setSelection(O.create(r.doc,e<0?o.start(l):o.end(l)))),!0):!1}}var ae=G(-1),fe=G(1);function pe(e,r){return function(t,n){var o=t.selection,l=o.$from,a=o.$to,f=l.blockRange(a),i=f&&U(f,e,r);return i?(n&&n(t.tr.wrap(f,i).scrollIntoView()),!0):!1}}function de(e,r){return function(t,n){var o=t.selection,l=o.from,a=o.to,f=!1;return t.doc.nodesBetween(l,a,function(i,c){if(f)return!1;if(!(!i.isTextblock||i.hasMarkup(e,r)))if(i.type==e)f=!0;else{var s=t.doc.resolve(c),u=s.index();f=s.parent.canReplaceWith(u,u+1,e)}}),f?(n&&n(t.tr.setBlockType(l,a,e,r).scrollIntoView()),!0):!1}}function ie(e,r,t){for(var n=function(a){var f=r[a],i=f.$from,c=f.$to,s=i.depth==0?e.type.allowsMarkType(t):!1;if(e.nodesBetween(i.pos,c.pos,function(u){if(s)return!1;s=u.inlineContent&&u.type.allowsMarkType(t)}),s)return{v:!0}},o=0;o<r.length;o++){var l=n(o);if(l)return l.v}return!1}function me(e,r){return function(t,n){var o=t.selection,l=o.empty,a=o.$cursor,f=o.ranges;if(l&&!a||!ie(t.doc,f,e))return!1;if(n)if(a)e.isInSet(t.storedMarks||a.marks())?n(t.tr.removeStoredMark(e)):n(t.tr.addStoredMark(e.create(r)));else{for(var i=!1,c=t.tr,s=0;!i&&s<f.length;s++){var u=f[s],B=u.$from,S=u.$to;i=t.doc.rangeHasMark(B.pos,S.pos,e)}for(var k=0;k<f.length;k++){var y=f[k],v=y.$from,p=y.$to;if(i)c.removeMark(v.pos,p.pos,e);else{var g=v.pos,b=p.pos,x=v.nodeAfter,w=p.nodeBefore,C=x&&x.isText?/^\s*/.exec(x.text)[0].length:0,Q=w&&w.isText?/\s*$/.exec(w.text)[0].length:0;g+C<b&&(g+=C,b-=Q),c.addMark(g,b,e.create(r))}}n(c.scrollIntoView())}return!0}}function D(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return function(t,n,o){for(var l=0;l<e.length;l++)if(e[l](t,n,o))return!0;return!1}}var z=D(K,X,Y),W=D(K,Z,_),d={Enter:D($,re,ne,oe),"Mod-Enter":ee,Backspace:z,"Mod-Backspace":z,"Shift-Backspace":z,Delete:W,"Mod-Delete":W,"Mod-a":te},L={"Ctrl-h":d.Backspace,"Alt-Backspace":d["Mod-Backspace"],"Ctrl-d":d.Delete,"Ctrl-Alt-Backspace":d["Mod-Delete"],"Alt-Delete":d["Mod-Delete"],"Alt-d":d["Mod-Delete"],"Ctrl-a":ae,"Ctrl-e":fe};for(var j in d)L[j]=d[j];var ce=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"?os.platform()=="darwin":!1,ge=ce?L:d;export{te as a,ge as b,D as c,K as d,ee as e,Z as j,$ as n,de as s,me as t,pe as w};
