import{T as F,N as k,S as vt,A as vr}from"./prosemirror-state.334938da.js";import{a as $,c as Tt,F as Q,D as Re,M as br}from"./prosemirror-model.b56130c8.js";import{d as Dr}from"./prosemirror-transform.ac9e639a.js";var p={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var Bt=/Edge\/(\d+)/.exec(navigator.userAgent),ue=/MSIE \d/.test(navigator.userAgent),It=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Ft=p.ie=!!(ue||It||Bt);p.ie_version=ue?document.documentMode||6:It?+It[1]:Bt?+Bt[1]:null,p.gecko=!Ft&&/gecko\/(\d+)/i.test(navigator.userAgent),p.gecko_version=p.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var zt=!Ft&&/Chrome\/(\d+)/.exec(navigator.userAgent);p.chrome=!!zt,p.chrome_version=zt&&+zt[1],p.safari=!Ft&&/Apple Computer/.test(navigator.vendor),p.ios=p.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),p.mac=p.ios||/Mac/.test(navigator.platform),p.android=/Android \d/.test(navigator.userAgent),p.webkit="webkitFontSmoothing"in document.documentElement.style,p.webkit_version=p.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var _=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Zt=function(t){var e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e},he=null,J=function(t,e,r){var n=he||(he=document.createRange());return n.setEnd(t,r==null?t.nodeValue.length:r),n.setStart(t,e||0),n},bt=function(t,e,r,n){return r&&(de(t,e,r,n,-1)||de(t,e,r,n,1))},Or=/^(img|br|input|textarea|hr)$/i;function de(t,e,r,n,o){for(;;){if(t==r&&e==n)return!0;if(e==(o<0?0:G(t))){var i=t.parentNode;if(!i||i.nodeType!=1||Nr(t)||Or.test(t.nodeName)||t.contentEditable=="false")return!1;e=_(t)+(o<0?0:1),t=i}else if(t.nodeType==1){if(t=t.childNodes[e+(o<0?-1:0)],t.contentEditable=="false")return!1;e=o<0?G(t):0}else return!1}}function G(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Cr(t,e,r){for(var n=e==0,o=e==G(t);n||o;){if(t==r)return!0;var i=_(t);if(t=t.parentNode,!t)return!1;n=n&&i==0,o=o&&i==G(t)}}function Nr(t){for(var e,r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var Xt=function(t){var e=t.isCollapsed;return e&&p.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function ft(t,e){var r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function Sr(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Z(t,e){return typeof t=="number"?t:t[e]}function Mr(t){var e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*n}}function pe(t,e,r){for(var n=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument,s=r||t.dom;s;s=Zt(s))if(s.nodeType==1){var a=s==i.body||s.nodeType!=1,l=a?Sr(i):Mr(s),c=0,u=0;if(e.top<l.top+Z(n,"top")?u=-(l.top-e.top+Z(o,"top")):e.bottom>l.bottom-Z(n,"bottom")&&(u=e.bottom-l.bottom+Z(o,"bottom")),e.left<l.left+Z(n,"left")?c=-(l.left-e.left+Z(o,"left")):e.right>l.right-Z(n,"right")&&(c=e.right-l.right+Z(o,"right")),c||u)if(a)i.defaultView.scrollBy(c,u);else{var f=s.scrollLeft,h=s.scrollTop;u&&(s.scrollTop+=u),c&&(s.scrollLeft+=c);var d=s.scrollLeft-f,m=s.scrollTop-h;e={left:e.left-d,top:e.top-m,right:e.right-d,bottom:e.bottom-m}}if(a)break}}function kr(t){for(var e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),n,o,i=(e.left+e.right)/2,s=r+1;s<Math.min(innerHeight,e.bottom);s+=5){var a=t.root.elementFromPoint(i,s);if(!(a==t.dom||!t.dom.contains(a))){var l=a.getBoundingClientRect();if(l.top>=r-20){n=a,o=l.top;break}}}return{refDOM:n,refTop:o,stack:Be(t.dom)}}function Be(t){for(var e=[],r=t.ownerDocument;t&&(e.push({dom:t,top:t.scrollTop,left:t.scrollLeft}),t!=r);t=Zt(t));return e}function Tr(t){var e=t.refDOM,r=t.refTop,n=t.stack,o=e?e.getBoundingClientRect().top:0;Ie(n,o==0?0:o-r)}function Ie(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=n.dom,i=n.top,s=n.left;o.scrollTop!=i+e&&(o.scrollTop=i+e),o.scrollLeft!=s&&(o.scrollLeft=s)}}var ct=null;function Ar(t){if(t.setActive)return t.setActive();if(ct)return t.focus(ct);var e=Be(t);t.focus(ct==null?{get preventScroll(){return ct={preventScroll:!0},!0}}:void 0),ct||(ct=!1,Ie(e,0))}function Fe(t,e){for(var r,n=2e8,o,i=0,s=e.top,a=e.top,l=t.firstChild,c=0;l;l=l.nextSibling,c++){var u=void 0;if(l.nodeType==1)u=l.getClientRects();else if(l.nodeType==3)u=J(l).getClientRects();else continue;for(var f=0;f<u.length;f++){var h=u[f];if(h.top<=s&&h.bottom>=a){s=Math.max(h.bottom,s),a=Math.min(h.top,a);var d=h.left>e.left?h.left-e.left:h.right<e.left?e.left-h.right:0;if(d<n){r=l,n=d,o=d&&r.nodeType==3?{left:h.right<e.left?h.right:h.left,top:e.top}:e,l.nodeType==1&&d&&(i=c+(e.left>=(h.left+h.right)/2?1:0));continue}}!r&&(e.left>=h.right&&e.top>=h.top||e.left>=h.left&&e.top>=h.bottom)&&(i=c+1)}}return r&&r.nodeType==3?Pr(r,o):!r||n&&r.nodeType==1?{node:t,offset:i}:Fe(r,o)}function Pr(t,e){for(var r=t.nodeValue.length,n=document.createRange(),o=0;o<r;o++){n.setEnd(t,o+1),n.setStart(t,o);var i=X(n,1);if(i.top!=i.bottom&&$t(e,i))return{node:t,offset:o+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}function $t(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Er(t,e){var r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function xr(t,e,r){var n=Fe(e,r),o=n.node,i=n.offset,s=-1;if(o.nodeType==1&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&r.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(o,i,s)}function Vr(t,e,r,n){for(var o=-1,i=e;i!=t.dom;){var s=t.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>n.left||a.top>n.top)o=s.posBefore;else if(a.right<n.left||a.bottom<n.top)o=s.posAfter;else break}i=s.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,r)}function ze(t,e,r){var n=t.childNodes.length;if(n&&r.top<r.bottom)for(var o=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-r.top)/(r.bottom-r.top))-2)),i=o;;){var s=t.childNodes[i];if(s.nodeType==1)for(var a=s.getClientRects(),l=0;l<a.length;l++){var c=a[l];if($t(e,c))return ze(s,e,c)}if((i=(i+1)%n)==o)break}return t}function Rr(t,e){var r,n,o=t.dom.ownerDocument,i,s;if(o.caretPositionFromPoint)try{var a=o.caretPositionFromPoint(e.left,e.top);a&&(r=a,i=r.offsetNode,s=r.offset)}catch{}if(!i&&o.caretRangeFromPoint){var l=o.caretRangeFromPoint(e.left,e.top);l&&(n=l,i=n.startContainer,s=n.startOffset)}var c=(t.root.elementFromPoint?t.root:o).elementFromPoint(e.left,e.top+1),u;if(!c||!t.dom.contains(c.nodeType!=1?c.parentNode:c)){var f=t.dom.getBoundingClientRect();if(!$t(e,f)||(c=ze(t.dom,e,f),!c))return null}if(p.safari)for(var h=c;i&&h;h=Zt(h))h.draggable&&(i=s=null);if(c=Er(c,e),i){if(p.gecko&&i.nodeType==1&&(s=Math.min(s,i.childNodes.length),s<i.childNodes.length)){var d=i.childNodes[s],m;d.nodeName=="IMG"&&(m=d.getBoundingClientRect()).right<=e.left&&m.bottom>e.top&&s++}i==t.dom&&s==i.childNodes.length-1&&i.lastChild.nodeType==1&&e.top>i.lastChild.getBoundingClientRect().bottom?u=t.state.doc.content.size:(s==0||i.nodeType!=1||i.childNodes[s-1].nodeName!="BR")&&(u=Vr(t,i,s,e))}u==null&&(u=xr(t,c,e));var y=t.docView.nearestDesc(c,!0);return{pos:u,inside:y?y.posAtStart-y.border:-1}}function X(t,e){var r=t.getClientRects();return r.length?r[e<0?0:r.length-1]:t.getBoundingClientRect()}var Br=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function _e(t,e,r){var n=t.docView.domFromPos(e,r<0?-1:1),o=n.node,i=n.offset,s=p.webkit||p.gecko;if(o.nodeType==3)if(s&&(Br.test(o.nodeValue)||(r<0?!i:i==o.nodeValue.length))){var a=X(J(o,i,i),r);if(p.gecko&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var l=X(J(o,i-1,i-1),-1);if(l.top==a.top){var c=X(J(o,i,i+1),-1);if(c.top!=a.top)return pt(c,c.left<l.left)}}return a}else{var u=i,f=i,h=r<0?1:-1;return r<0&&!i?(f++,h=-1):r>=0&&i==o.nodeValue.length?(u--,h=1):r<0?u--:f++,pt(X(J(o,u,f),h),h<0)}if(!t.state.doc.resolve(e).parent.inlineContent){if(i&&(r<0||i==G(o))){var d=o.childNodes[i-1];if(d.nodeType==1)return _t(d.getBoundingClientRect(),!1)}if(i<G(o)){var m=o.childNodes[i];if(m.nodeType==1)return _t(m.getBoundingClientRect(),!0)}return _t(o.getBoundingClientRect(),r>=0)}if(i&&(r<0||i==G(o))){var y=o.childNodes[i-1],O=y.nodeType==3?J(y,G(y)-(s?0:1)):y.nodeType==1&&(y.nodeName!="BR"||!y.nextSibling)?y:null;if(O)return pt(X(O,1),!1)}if(i<G(o)){for(var v=o.childNodes[i];v.pmViewDesc&&v.pmViewDesc.ignoreForCoords;)v=v.nextSibling;var g=v?v.nodeType==3?J(v,0,s?0:1):v.nodeType==1?v:null:null;if(g)return pt(X(g,-1),!0)}return pt(X(o.nodeType==3?J(o):o,-r),r>=0)}function pt(t,e){if(t.width==0)return t;var r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function _t(t,e){if(t.height==0)return t;var r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function Le(t,e,r){var n=t.state,o=t.root.activeElement;n!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return r()}finally{n!=e&&t.updateState(n),o!=t.dom&&o&&o.focus()}}function Ir(t,e,r){var n=e.selection,o=r=="up"?n.$from:n.$to;return Le(t,e,function(){for(var i=t.docView.domFromPos(o.pos,r=="up"?-1:1),s=i.node;;){var a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}for(var l=_e(t,o.pos,1),c=s.firstChild;c;c=c.nextSibling){var u=void 0;if(c.nodeType==1)u=c.getClientRects();else if(c.nodeType==3)u=J(c,0,c.nodeValue.length).getClientRects();else continue;for(var f=0;f<u.length;f++){var h=u[f];if(h.bottom>h.top+1&&(r=="up"?l.top-h.top>(h.bottom-l.top)*2:h.bottom-l.bottom>(l.bottom-h.top)*2))return!1}}return!0})}var Fr=/[\u0590-\u08ac]/;function zr(t,e,r){var n=e.selection,o=n.$head;if(!o.parent.isTextblock)return!1;var i=o.parentOffset,s=!i,a=i==o.parent.content.size,l=t.root.getSelection();return!Fr.test(o.parent.textContent)||!l.modify?r=="left"||r=="backward"?s:a:Le(t,e,function(){var c=l.getRangeAt(0),u=l.focusNode,f=l.focusOffset,h=l.caretBidiLevel;l.modify("move",r,"character");var d=o.depth?t.docView.domAfterPos(o.before()):t.dom,m=!d.contains(l.focusNode.nodeType==1?l.focusNode:l.focusNode.parentNode)||u==l.focusNode&&f==l.focusOffset;return l.removeAllRanges(),l.addRange(c),h!=null&&(l.caretBidiLevel=h),m})}var me=null,ge=null,ye=!1;function _r(t,e,r){return me==e&&ge==r?ye:(me=e,ge=r,ye=r=="up"||r=="down"?Ir(t,e,r):zr(t,e,r))}var W=0,qe=1,mt=2,j=3,N=function(e,r,n,o){this.parent=e,this.children=r,this.dom=n,n.pmViewDesc=this,this.contentDOM=o,this.dirty=W},Y={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};N.prototype.matchesWidget=function(){return!1};N.prototype.matchesMark=function(){return!1};N.prototype.matchesNode=function(){return!1};N.prototype.matchesHack=function(e){return!1};N.prototype.parseRule=function(){return null};N.prototype.stopEvent=function(){return!1};Y.size.get=function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t};Y.border.get=function(){return 0};N.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var e=0;e<this.children.length;e++)this.children[e].destroy()};N.prototype.posBeforeChild=function(e){for(var r=0,n=this.posAtStart;r<this.children.length;r++){var o=this.children[r];if(o==e)return n;n+=o.size}};Y.posBefore.get=function(){return this.parent.posBeforeChild(this)};Y.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};Y.posAfter.get=function(){return this.posBefore+this.size};Y.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};N.prototype.localPosFromDOM=function(e,r,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){var o,i;if(e==this.contentDOM)o=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.previousSibling}for(;o&&!((i=o.pmViewDesc)&&i.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(i)+i.size:this.posAtStart}else{var s,a;if(e==this.contentDOM)s=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((a=s.pmViewDesc)&&a.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(a):this.posAtEnd}var l;if(e==this.dom&&this.contentDOM)l=r>_(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))l=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(var c=e;;c=c.parentNode){if(c==this.dom){l=!1;break}if(c.parentNode.firstChild!=c)break}if(l==null&&r==e.childNodes.length)for(var u=e;;u=u.parentNode){if(u==this.dom){l=!0;break}if(u.parentNode.lastChild!=u)break}}return(l==null?n>0:l)?this.posAtEnd:this.posAtStart};N.prototype.nearestDesc=function(e,r){for(var n=!0,o=e;o;o=o.parentNode){var i=this.getDesc(o);if(i&&(!r||i.node))if(n&&i.nodeDOM&&!(i.nodeDOM.nodeType==1?i.nodeDOM.contains(e.nodeType==1?e:e.parentNode):i.nodeDOM==e))n=!1;else return i}};N.prototype.getDesc=function(e){for(var r=e.pmViewDesc,n=r;n;n=n.parent)if(n==this)return r};N.prototype.posFromDOM=function(e,r,n){for(var o=e;o;o=o.parentNode){var i=this.getDesc(o);if(i)return i.localPosFromDOM(e,r,n)}return-1};N.prototype.descAt=function(e){for(var r=0,n=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==e&&i!=n){for(;!o.border&&o.children.length;)o=o.children[0];return o}if(e<i)return o.descAt(e-n-o.border);n=i}};N.prototype.domFromPos=function(e,r){if(!this.contentDOM)return{node:this.dom,offset:0};for(var n=0,o=0,i=0;n<this.children.length;n++){var s=this.children[n],a=i+s.size;if(a>e||s instanceof Ue){o=e-i;break}i=a}if(o)return this.children[n].domFromPos(o-this.children[n].border,r);for(var l=void 0;n&&!(l=this.children[n-1]).size&&l instanceof Ke&&l.widget.type.side>=0;n--);if(r<=0){for(var c,u=!0;c=n?this.children[n-1]:null,!(!c||c.dom.parentNode==this.contentDOM);n--,u=!1);return c&&r&&u&&!c.border&&!c.domAtom?c.domFromPos(c.size,r):{node:this.contentDOM,offset:c?_(c.dom)+1:0}}else{for(var f,h=!0;f=n<this.children.length?this.children[n]:null,!(!f||f.dom.parentNode==this.contentDOM);n++,h=!1);return f&&h&&!f.border&&!f.domAtom?f.domFromPos(0,r):{node:this.contentDOM,offset:f?_(f.dom):this.contentDOM.childNodes.length}}};N.prototype.parseRange=function(e,r,n){if(n===void 0&&(n=0),this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var o=-1,i=-1,s=n,a=0;;a++){var l=this.children[a],c=s+l.size;if(o==-1&&e<=c){var u=s+l.border;if(e>=u&&r<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,r,u);e=s;for(var f=a;f>0;f--){var h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){o=_(h.dom)+1;break}e-=h.size}o==-1&&(o=0)}if(o>-1&&(c>r||a==this.children.length-1)){r=c;for(var d=a+1;d<this.children.length;d++){var m=this.children[d];if(m.size&&m.dom.parentNode==this.contentDOM&&!m.emptyChildAt(-1)){i=_(m.dom);break}r+=m.size}i==-1&&(i=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:e,to:r,fromOffset:o,toOffset:i}};N.prototype.emptyChildAt=function(e){if(this.border||!this.contentDOM||!this.children.length)return!1;var r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)};N.prototype.domAfterPos=function(e){var r=this.domFromPos(e,0),n=r.node,o=r.offset;if(n.nodeType!=1||o==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[o]};N.prototype.setSelection=function(e,r,n,o){for(var i=Math.min(e,r),s=Math.max(e,r),a=0,l=0;a<this.children.length;a++){var c=this.children[a],u=l+c.size;if(i>l&&s<u)return c.setSelection(e-l-c.border,r-l-c.border,n,o);l=u}var f=this.domFromPos(e,e?-1:1),h=r==e?f:this.domFromPos(r,r?-1:1),d=n.getSelection(),m=!1;if((p.gecko||p.safari)&&e==r){var y=f.node,O=f.offset;if(y.nodeType==3){if(m=O&&y.nodeValue[O-1]==`
`,m&&O==y.nodeValue.length)for(var v=y,g=void 0;v;v=v.parentNode){if(g=v.nextSibling){g.nodeName=="BR"&&(f=h={node:g.parentNode,offset:_(g)+1});break}var S=v.pmViewDesc;if(S&&S.node&&S.node.isBlock)break}}else{var b=y.childNodes[O-1];m=b&&(b.nodeName=="BR"||b.contentEditable=="false")}}if(p.gecko&&d.focusNode&&d.focusNode!=h.node&&d.focusNode.nodeType==1){var D=d.focusNode.childNodes[d.focusOffset];D&&D.contentEditable=="false"&&(o=!0)}if(!(!(o||m&&p.safari)&&bt(f.node,f.offset,d.anchorNode,d.anchorOffset)&&bt(h.node,h.offset,d.focusNode,d.focusOffset))){var M=!1;if((d.extend||e==r)&&!m){d.collapse(f.node,f.offset);try{e!=r&&d.extend(h.node,h.offset),M=!0}catch(V){if(!(V instanceof DOMException))throw V}}if(!M){if(e>r){var U=f;f=h,h=U}var T=document.createRange();T.setEnd(h.node,h.offset),T.setStart(f.node,f.offset),d.removeAllRanges(),d.addRange(T)}}};N.prototype.ignoreMutation=function(e){return!this.contentDOM&&e.type!="selection"};Y.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};N.prototype.markDirty=function(e,r){for(var n=0,o=0;o<this.children.length;o++){var i=this.children[o],s=n+i.size;if(n==s?e<=s&&r>=n:e<s&&r>n){var a=n+i.border,l=s-i.border;if(e>=a&&r<=l){this.dirty=e==n||r==s?mt:qe,e==a&&r==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=j:i.markDirty(e-a,r-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?mt:j}n=s}this.dirty=mt};N.prototype.markParentsDirty=function(){for(var e=1,r=this.parent;r;r=r.parent,e++){var n=e==1?mt:qe;r.dirty<n&&(r.dirty=n)}};Y.domAtom.get=function(){return!1};Y.ignoreForCoords.get=function(){return!1};Object.defineProperties(N.prototype,Y);var w=[],Ke=function(t){function e(n,o,i,s){var a,l=o.type.toDOM;if(typeof l=="function"&&(l=l(i,function(){if(!a)return s;if(a.parent)return a.parent.posBeforeChild(a)})),!o.type.spec.raw){if(l.nodeType!=1){var c=document.createElement("span");c.appendChild(l),l=c}l.contentEditable=!1,l.classList.add("ProseMirror-widget")}t.call(this,n,w,l,null),this.widget=o,a=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0}};return e.prototype.matchesWidget=function(o){return this.dirty==W&&o.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(o){var i=this.widget.spec.stopEvent;return i?i(o):!1},e.prototype.ignoreMutation=function(o){return o.type!="selection"||this.widget.spec.ignoreSelection},e.prototype.destroy=function(){this.widget.type.destroy(this.dom),t.prototype.destroy.call(this)},r.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,r),e}(N),Lr=function(t){function e(n,o,i,s){t.call(this,n,w,o,null),this.textDOM=i,this.text=s}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={size:{configurable:!0}};return r.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(o,i){return o!=this.textDOM?this.posAtStart+(i?this.size:0):this.posAtStart+i},e.prototype.domFromPos=function(o){return{node:this.textDOM,offset:o}},e.prototype.ignoreMutation=function(o){return o.type==="characterData"&&o.target.nodeValue==o.oldValue},Object.defineProperties(e.prototype,r),e}(N),At=function(t){function e(r,n,o,i){t.call(this,r,[],o,i),this.mark=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(n,o,i,s){var a=s.nodeViews[o.type.name],l=a&&a(o,s,i);return(!l||!l.dom)&&(l=Tt.renderSpec(document,o.type.spec.toDOM(o,i))),new e(n,o,l.dom,l.contentDOM||l.dom)},e.prototype.parseRule=function(){return this.dirty&j||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(n){return this.dirty!=j&&this.mark.eq(n)},e.prototype.markDirty=function(n,o){if(t.prototype.markDirty.call(this,n,o),this.dirty!=W){for(var i=this.parent;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=W}},e.prototype.slice=function(n,o,i){var s=e.create(this.parent,this.mark,!0,i),a=this.children,l=this.size;o<l&&(a=Gt(a,o,l,i)),n>0&&(a=Gt(a,0,n,i));for(var c=0;c<a.length;c++)a[c].parent=s;return s.children=a,s},e}(N),Ct=function(t){function e(n,o,i,s,a,l,c,u,f){t.call(this,n,o.isLeaf?w:[],a,l),this.nodeDOM=c,this.node=o,this.outerDeco=i,this.innerDeco=s,l&&this.updateChildren(u,f)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(o,i,s,a,l,c){var u,f=l.nodeViews[i.type.name],h,d=f&&f(i,l,function(){if(!h)return c;if(h.parent)return h.parent.posBeforeChild(h)},s,a),m=d&&d.dom,y=d&&d.contentDOM;if(i.isText){if(!m)m=document.createTextNode(i.text);else if(m.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else m||(u=Tt.renderSpec(document,i.type.spec.toDOM(i)),m=u.dom,y=u.contentDOM);!y&&!i.isText&&m.nodeName!="BR"&&(m.hasAttribute("contenteditable")||(m.contentEditable=!1),i.type.spec.draggable&&(m.draggable=!0));var O=m;return m=Je(m,s,i),d?h=new qr(o,i,s,a,m,y,O,d,l,c+1):i.isText?new He(o,i,s,a,m,O,l):new e(o,i,s,a,m,y,O,l,c+1)},e.prototype.parseRule=function(){var o=this;if(this.node.type.spec.reparseInView)return null;var i={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(i.preserveWhitespace="full"),!this.contentDOM)i.getContent=function(){return o.node.content};else if(!this.contentLost)i.contentElement=this.contentDOM;else{for(var s=this.children.length-1;s>=0;s--){var a=this.children[s];if(this.dom.contains(a.dom.parentNode)){i.contentElement=a.dom.parentNode;break}}i.contentElement||(i.getContent=function(){return Q.empty})}return i},e.prototype.matchesNode=function(o,i,s){return this.dirty==W&&o.eq(this.node)&&Ut(i,this.outerDeco)&&s.eq(this.innerDeco)},r.size.get=function(){return this.node.nodeSize},r.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(o,i){var s=this,a=this.node.inlineContent,l=i,c=o.composing&&this.localCompositionInfo(o,i),u=c&&c.pos>-1?c:null,f=c&&c.pos<0,h=new K(this,u&&u.node);Ur(this.node,this.innerDeco,function(d,m,y){d.spec.marks?h.syncToMarks(d.spec.marks,a,o):d.type.side>=0&&!y&&h.syncToMarks(m==s.node.childCount?br.none:s.node.child(m).marks,a,o),h.placeWidget(d,o,l)},function(d,m,y,O){h.syncToMarks(d.marks,a,o);var v;h.findNodeMatch(d,m,y,O)||f&&o.state.selection.from>l&&o.state.selection.to<l+d.nodeSize&&(v=h.findIndexWithChild(c.node))>-1&&h.updateNodeAt(d,m,y,v,o)||h.updateNextNode(d,m,y,o,O)||h.addNode(d,m,y,o,l),l+=d.nodeSize}),h.syncToMarks(w,a,o),this.node.isTextblock&&h.addTextblockHacks(),h.destroyRest(),(h.changed||this.dirty==mt)&&(u&&this.protectLocalComposition(o,u),Ge(this.contentDOM,this.children,o),p.ios&&Gr(this.dom))},e.prototype.localCompositionInfo=function(o,i){var s=o.state.selection,a=s.from,l=s.to;if(!(!(o.state.selection instanceof F)||a<i||l>i+this.node.content.size)){var c=o.root.getSelection(),u=Yr(c.focusNode,c.focusOffset);if(!(!u||!this.dom.contains(u.parentNode)))if(this.node.inlineContent){var f=u.nodeValue,h=Jr(this.node.content,f,a-i,l-i);return h<0?null:{node:u,pos:h,text:f}}else return{node:u,pos:-1}}},e.prototype.protectLocalComposition=function(o,i){var s=i.node,a=i.pos,l=i.text;if(!this.getDesc(s)){for(var c=s;c.parentNode!=this.contentDOM;c=c.parentNode){for(;c.previousSibling;)c.parentNode.removeChild(c.previousSibling);for(;c.nextSibling;)c.parentNode.removeChild(c.nextSibling);c.pmViewDesc&&(c.pmViewDesc=null)}var u=new Lr(this,c,s,l);o.compositionNodes.push(u),this.children=Gt(this.children,a,a+l.length,o,u)}},e.prototype.update=function(o,i,s,a){return this.dirty==j||!o.sameMarkup(this.node)?!1:(this.updateInner(o,i,s,a),!0)},e.prototype.updateInner=function(o,i,s,a){this.updateOuterDeco(i),this.node=o,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=W},e.prototype.updateOuterDeco=function(o){if(!Ut(o,this.outerDeco)){var i=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=Ye(this.dom,this.nodeDOM,Ht(this.outerDeco,this.node,i),Ht(o,this.node,i)),this.dom!=s&&(s.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=o}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},r.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,r),e}(N);function We(t,e,r,n,o){return Je(n,e,t),new Ct(null,t,e,r,n,n,n,o,0)}var He=function(t){function e(n,o,i,s,a,l,c){t.call(this,n,o,i,s,a,null,l,c)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){for(var o=this.nodeDOM.parentNode;o&&o!=this.dom&&!o.pmIsDeco;)o=o.parentNode;return{skip:o||!0}},e.prototype.update=function(o,i,s,a){return this.dirty==j||this.dirty!=W&&!this.inParent()||!o.sameMarkup(this.node)?!1:(this.updateOuterDeco(i),(this.dirty!=W||o.text!=this.node.text)&&o.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=o.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=o,this.dirty=W,!0)},e.prototype.inParent=function(){for(var o=this.parent.contentDOM,i=this.nodeDOM;i;i=i.parentNode)if(i==o)return!0;return!1},e.prototype.domFromPos=function(o){return{node:this.nodeDOM,offset:o}},e.prototype.localPosFromDOM=function(o,i,s){return o==this.nodeDOM?this.posAtStart+Math.min(i,this.node.text.length):t.prototype.localPosFromDOM.call(this,o,i,s)},e.prototype.ignoreMutation=function(o){return o.type!="characterData"&&o.type!="selection"},e.prototype.slice=function(o,i,s){var a=this.node.cut(o,i),l=document.createTextNode(a.text);return new e(this.parent,a,this.outerDeco,this.innerDeco,l,l,s)},e.prototype.markDirty=function(o,i){t.prototype.markDirty.call(this,o,i),this.dom!=this.nodeDOM&&(o==0||i==this.nodeDOM.nodeValue.length)&&(this.dirty=j)},r.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,r),e}(Ct),Ue=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(o){return this.dirty==W&&this.dom.nodeName==o},r.domAtom.get=function(){return!0},r.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(e.prototype,r),e}(N),qr=function(t){function e(r,n,o,i,s,a,l,c,u,f){t.call(this,r,n,o,i,s,a,l,u,f),this.spec=c}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(n,o,i,s){if(this.dirty==j)return!1;if(this.spec.update){var a=this.spec.update(n,o,i);return a&&this.updateInner(n,o,i,s),a}else return!this.contentDOM&&!n.isLeaf?!1:t.prototype.update.call(this,n,o,i,s)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},e.prototype.setSelection=function(n,o,i,s){this.spec.setSelection?this.spec.setSelection(n,o,i):t.prototype.setSelection.call(this,n,o,i,s)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e.prototype.stopEvent=function(n){return this.spec.stopEvent?this.spec.stopEvent(n):!1},e.prototype.ignoreMutation=function(n){return this.spec.ignoreMutation?this.spec.ignoreMutation(n):t.prototype.ignoreMutation.call(this,n)},e}(Ct);function Ge(t,e,r){for(var n=t.firstChild,o=!1,i=0;i<e.length;i++){var s=e[i],a=s.dom;if(a.parentNode==t){for(;a!=n;)n=ve(n),o=!0;n=n.nextSibling}else o=!0,t.insertBefore(a,n);if(s instanceof At){var l=n?n.previousSibling:t.lastChild;Ge(s.contentDOM,s.children,r),n=l?l.nextSibling:t.firstChild}}for(;n;)n=ve(n),o=!0;o&&r.trackWrites==t&&(r.trackWrites=null)}function gt(t){t&&(this.nodeName=t)}gt.prototype=Object.create(null);var it=[new gt];function Ht(t,e,r){if(t.length==0)return it;for(var n=r?it[0]:new gt,o=[n],i=0;i<t.length;i++){var s=t[i].type.attrs;if(!!s){s.nodeName&&o.push(n=new gt(s.nodeName));for(var a in s){var l=s[a];l!=null&&(r&&o.length==1&&o.push(n=new gt(e.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return o}function Ye(t,e,r,n){if(r==it&&n==it)return e;for(var o=e,i=0;i<n.length;i++){var s=n[i],a=r[i];if(i){var l=void 0;a&&a.nodeName==s.nodeName&&o!=t&&(l=o.parentNode)&&l.tagName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(o),a=it[0]),o=l}Kr(o,a||it[0],s)}return o}function Kr(t,e,r){for(var n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)&&t.removeAttribute(n);for(var o in r)o!="class"&&o!="style"&&o!="nodeName"&&r[o]!=e[o]&&t.setAttribute(o,r[o]);if(e.class!=r.class){for(var i=e.class?e.class.split(" ").filter(Boolean):w,s=r.class?r.class.split(" ").filter(Boolean):w,a=0;a<i.length;a++)s.indexOf(i[a])==-1&&t.classList.remove(i[a]);for(var l=0;l<s.length;l++)i.indexOf(s[l])==-1&&t.classList.add(s[l]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=r.style){if(e.style)for(var c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,u;u=c.exec(e.style);)t.style.removeProperty(u[1]);r.style&&(t.style.cssText+=r.style)}}function Je(t,e,r){return Ye(t,t,it,Ht(e,r,t.nodeType!=1))}function Ut(t,e){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function ve(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var K=function(e,r){this.top=e,this.lock=r,this.index=0,this.stack=[],this.changed=!1,this.preMatch=Wr(e.node.content,e)};K.prototype.destroyBetween=function(e,r){if(e!=r){for(var n=e;n<r;n++)this.top.children[n].destroy();this.top.children.splice(e,r-e),this.changed=!0}};K.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};K.prototype.syncToMarks=function(e,r,n){for(var o=0,i=this.stack.length>>1,s=Math.min(i,e.length);o<s&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(e[o])&&e[o].type.spec.spanning!==!1;)o++;for(;o<i;)this.destroyRest(),this.top.dirty=W,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);for(var a=-1,l=this.index;l<Math.min(this.index+3,this.top.children.length);l++)if(this.top.children[l].matchesMark(e[i])){a=l;break}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{var c=At.create(this.top,e[i],r,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,i++}};K.prototype.findNodeMatch=function(e,r,n,o){var i=-1,s;if(o>=this.preMatch.index&&(s=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&s.matchesNode(e,r,n))i=this.top.children.indexOf(s,this.index);else for(var a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){var c=this.top.children[a];if(c.matchesNode(e,r,n)&&!this.preMatch.matched.has(c)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)};K.prototype.updateNodeAt=function(e,r,n,o,i){var s=this.top.children[o];return s.update(e,r,n,i)?(this.destroyBetween(this.index,o),this.index=o+1,!0):!1};K.prototype.findIndexWithChild=function(e){for(;;){var r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){var n=e.pmViewDesc;if(n){for(var o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==n)return o}return-1}e=r}};K.prototype.updateNextNode=function(e,r,n,o,i){for(var s=this.index;s<this.top.children.length;s++){var a=this.top.children[s];if(a instanceof Ct){var l=this.preMatch.matched.get(a);if(l!=null&&l!=i)return!1;var c=a.dom,u=this.lock&&(c==this.lock||c.nodeType==1&&c.contains(this.lock.parentNode))&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&a.dirty!=j&&Ut(r,a.outerDeco));if(!u&&a.update(e,r,n,o))return this.destroyBetween(this.index,s),a.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1};K.prototype.addNode=function(e,r,n,o,i){this.top.children.splice(this.index++,0,Ct.create(this.top,e,r,n,o,i)),this.changed=!0};K.prototype.placeWidget=function(e,r,n){var o=this.index<this.top.children.length?this.top.children[this.index]:null;if(o&&o.matchesWidget(e)&&(e==o.widget||!o.widget.type.toDOM.parentNode))this.index++;else{var i=new Ke(this.top,e,r,n);this.top.children.splice(this.index++,0,i),this.changed=!0}};K.prototype.addTextblockHacks=function(){for(var e=this.top.children[this.index-1];e instanceof At;)e=e.children[e.children.length-1];(!e||!(e instanceof He)||/\n$/.test(e.node.text))&&((p.safari||p.chrome)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG"),this.addHackNode("BR"))};K.prototype.addHackNode=function(e){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(e))this.index++;else{var r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new Ue(this.top,w,r,null)),this.changed=!0}};function Wr(t,e){var r=e,n=r.children.length,o=t.childCount,i=new Map,s=[];t:for(;o>0;){for(var a=void 0;;)if(n){var l=r.children[n-1];if(l instanceof At)r=l,n=l.children.length;else{a=l,n--;break}}else{if(r==e)break t;n=r.parent.children.indexOf(r),r=r.parent}var c=a.node;if(!!c){if(c!=t.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}function Hr(t,e){return t.type.side-e.type.side}function Ur(t,e,r,n){var o=e.locals(t),i=0;if(o.length==0){for(var s=0;s<t.childCount;s++){var a=t.child(s);n(a,o,e.forChild(i,a),s),i+=a.nodeSize}return}for(var l=0,c=[],u=null,f=0;;){if(l<o.length&&o[l].to==i){for(var h=o[l++],d=void 0;l<o.length&&o[l].to==i;)(d||(d=[h])).push(o[l++]);if(d){d.sort(Hr);for(var m=0;m<d.length;m++)r(d[m],f,!!u)}else r(h,f,!!u)}var y=void 0,O=void 0;if(u)O=-1,y=u,u=null;else if(f<t.childCount)O=f,y=t.child(f++);else break;for(var v=0;v<c.length;v++)c[v].to<=i&&c.splice(v--,1);for(;l<o.length&&o[l].from<=i&&o[l].to>i;)c.push(o[l++]);var g=i+y.nodeSize;if(y.isText){var S=g;l<o.length&&o[l].from<S&&(S=o[l].from);for(var b=0;b<c.length;b++)c[b].to<S&&(S=c[b].to);S<g&&(u=y.cut(S-i),y=y.cut(0,S-i),g=S,O=-1)}var D=c.length?y.isInline&&!y.isLeaf?c.filter(function(M){return!M.inline}):c.slice():w;n(y,D,e.forChild(i,y),O),i=g}}function Gr(t){if(t.nodeName=="UL"||t.nodeName=="OL"){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Yr(t,e){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0){if(t.childNodes.length>e&&t.childNodes[e].nodeType==3)return t.childNodes[e];t=t.childNodes[e-1],e=G(t)}else if(t.nodeType==1&&e<t.childNodes.length)t=t.childNodes[e],e=0;else return null}}function Jr(t,e,r,n){for(var o=0,i=0;o<t.childCount&&i<=n;){var s=t.child(o++),a=i;if(i+=s.nodeSize,!!s.isText){for(var l=s.text;o<t.childCount;){var c=t.child(o++);if(i+=c.nodeSize,!c.isText)break;l+=c.text}if(i>=r){var u=a<n?l.lastIndexOf(e,n-a-1):-1;if(u>=0&&u+e.length+a>=r)return a+u;if(r==n&&l.length>=n+e.length-a&&l.slice(n-a,n-a+e.length)==e)return n}}}return-1}function Gt(t,e,r,n,o){for(var i=[],s=0,a=0;s<t.length;s++){var l=t[s],c=a,u=a+=l.size;c>=r||u<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,n)),o&&(i.push(o),o=null),u>r&&i.push(l.slice(r-c,l.size,n)))}return i}function je(t,e){var r=t.root.getSelection(),n=t.state.doc;if(!r.focusNode)return null;var o=t.docView.nearestDesc(r.focusNode),i=o&&o.size==0,s=t.docView.posFromDOM(r.focusNode,r.focusOffset);if(s<0)return null;var a=n.resolve(s),l,c;if(Xt(r)){for(l=a;o&&!o.node;)o=o.parent;if(o&&o.node.isAtom&&k.isSelectable(o.node)&&o.parent&&!(o.node.isInline&&Cr(r.focusNode,r.focusOffset,o.dom))){var u=o.posBefore;c=new k(s==u?a:n.resolve(u))}}else{var f=t.docView.posFromDOM(r.anchorNode,r.anchorOffset);if(f<0)return null;l=n.resolve(f)}if(!c){var h=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;c=wt(t,l,a,h)}return c}function Qe(t){return t.editable?t.hasFocus():te(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function tt(t,e){var r=t.state.selection;if(Ze(t,r),!!Qe(t)){if(!e&&t.mouseDown&&t.mouseDown.allowDefault&&p.chrome){var n=t.root.getSelection(),o=t.domObserver.currentSelection;if(n.anchorNode&&bt(n.anchorNode,n.anchorOffset,o.anchorNode,o.anchorOffset)){t.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Qr(t);else{var i=r.anchor,s=r.head,a,l;be&&!(r instanceof F)&&(r.$from.parent.inlineContent||(a=De(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(l=De(t,r.to))),t.docView.setSelection(i,s,t.root,e),be&&(a&&Oe(a),l&&Oe(l)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&jr(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}var be=p.safari||p.chrome&&p.chrome_version<63;function De(t,e){var r=t.docView.domFromPos(e,0),n=r.node,o=r.offset,i=o<n.childNodes.length?n.childNodes[o]:null,s=o?n.childNodes[o-1]:null;if(p.safari&&i&&i.contentEditable=="false")return Lt(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Lt(i);if(s)return Lt(s)}}function Lt(t){return t.contentEditable="true",p.safari&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Oe(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function jr(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.hideSelectionGuard);var r=t.root.getSelection(),n=r.anchorNode,o=r.anchorOffset;e.addEventListener("selectionchange",t.hideSelectionGuard=function(){(r.anchorNode!=n||r.anchorOffset!=o)&&(e.removeEventListener("selectionchange",t.hideSelectionGuard),setTimeout(function(){(!Qe(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function Qr(t){var e=t.root.getSelection(),r=document.createRange(),n=t.cursorWrapper.dom,o=n.nodeName=="IMG";o?r.setEnd(n.parentNode,_(n)+1):r.setEnd(n,0),r.collapse(!1),e.removeAllRanges(),e.addRange(r),!o&&!t.state.selection.visible&&p.ie&&p.ie_version<=11&&(n.disabled=!0,n.disabled=!1)}function Ze(t,e){if(e instanceof k){var r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(Ce(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else Ce(t)}function Ce(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=null)}function wt(t,e,r,n){return t.someProp("createSelectionBetween",function(o){return o(t,e,r)})||F.between(e,r,n)}function Zr(t){return t.editable&&t.root.activeElement!=t.dom?!1:te(t)}function te(t){var e=t.root.getSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Xr(t){var e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.root.getSelection();return bt(e.node,e.offset,r.anchorNode,r.anchorOffset)}function Yt(t,e){var r=t.selection,n=r.$anchor,o=r.$head,i=e>0?n.max(o):n.min(o),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&vt.findFrom(s,e)}function ot(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Ne(t,e,r){var n=t.state.selection;if(n instanceof F){if(!n.empty||r.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){var o=Yt(t.state,e);return o&&o instanceof k?ot(t,o):!1}else if(!(p.mac&&r.indexOf("m")>-1)){var i=n.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,a;if(!s||s.isText)return!1;var l=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(a=t.docView.descAt(l))&&!a.contentDOM?k.isSelectable(s)?ot(t,new k(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):p.webkit?ot(t,new F(t.state.doc.resolve(e<0?l:l+s.nodeSize))):!1:!1}}else{if(n instanceof k&&n.node.isInline)return ot(t,new F(e>0?n.$to:n.$from));var c=Yt(t.state,e);return c?ot(t,c):!1}}function St(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function yt(t){var e=t.pmViewDesc;return e&&e.size==0&&(t.nextSibling||t.nodeName!="BR")}function qt(t){var e=t.root.getSelection(),r=e.focusNode,n=e.focusOffset;if(!!r){var o,i,s=!1;for(p.gecko&&r.nodeType==1&&n<St(r)&&yt(r.childNodes[n])&&(s=!0);;)if(n>0){if(r.nodeType!=1)break;var a=r.childNodes[n-1];if(yt(a))o=r,i=--n;else if(a.nodeType==3)r=a,n=r.nodeValue.length;else break}else{if(Xe(r))break;for(var l=r.previousSibling;l&&yt(l);)o=r.parentNode,i=_(l),l=l.previousSibling;if(l)r=l,n=St(r);else{if(r=r.parentNode,r==t.dom)break;n=0}}s?Jt(t,e,r,n):o&&Jt(t,e,o,i)}}function Kt(t){var e=t.root.getSelection(),r=e.focusNode,n=e.focusOffset;if(!!r){for(var o=St(r),i,s;;)if(n<o){if(r.nodeType!=1)break;var a=r.childNodes[n];if(yt(a))i=r,s=++n;else break}else{if(Xe(r))break;for(var l=r.nextSibling;l&&yt(l);)i=l.parentNode,s=_(l)+1,l=l.nextSibling;if(l)r=l,n=0,o=St(r);else{if(r=r.parentNode,r==t.dom)break;n=o=0}}i&&Jt(t,e,i,s)}}function Xe(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Jt(t,e,r,n){if(Xt(e)){var o=document.createRange();o.setEnd(r,n),o.setStart(r,n),e.removeAllRanges(),e.addRange(o)}else e.extend&&e.extend(r,n);t.domObserver.setCurSelection();var i=t.state;setTimeout(function(){t.state==i&&tt(t)},50)}function Se(t,e,r){var n=t.state.selection;if(n instanceof F&&!n.empty||r.indexOf("s")>-1||p.mac&&r.indexOf("m")>-1)return!1;var o=n.$from,i=n.$to;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var s=Yt(t.state,e);if(s&&s instanceof k)return ot(t,s)}if(!o.parent.inlineContent){var a=e<0?o:i,l=n instanceof vr?vt.near(a,e):vt.findFrom(a,e);return l?ot(t,l):!1}return!1}function Me(t,e){if(!(t.state.selection instanceof F))return!0;var r=t.state.selection,n=r.$head,o=r.$anchor,i=r.empty;if(!n.sameParent(o))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){var a=t.state.tr;return e<0?a.delete(n.pos-s.nodeSize,n.pos):a.delete(n.pos,n.pos+s.nodeSize),t.dispatch(a),!0}return!1}function ke(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function $r(t){if(!(!p.safari||t.state.selection.$head.parentOffset>0)){var e=t.root.getSelection(),r=e.focusNode,n=e.focusOffset;if(r&&r.nodeType==1&&n==0&&r.firstChild&&r.firstChild.contentEditable=="false"){var o=r.firstChild;ke(t,o,!0),setTimeout(function(){return ke(t,o,!1)},20)}}}function wr(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function tn(t,e){var r=e.keyCode,n=wr(e);return r==8||p.mac&&r==72&&n=="c"?Me(t,-1)||qt(t):r==46||p.mac&&r==68&&n=="c"?Me(t,1)||Kt(t):r==13||r==27?!0:r==37?Ne(t,-1,n)||qt(t):r==39?Ne(t,1,n)||Kt(t):r==38?Se(t,-1,n)||qt(t):r==40?$r(t)||Se(t,1,n)||Kt(t):n==(p.mac?"m":"c")&&(r==66||r==73||r==89||r==90)}function en(t,e,r){var n=t.docView.parseRange(e,r),o=n.node,i=n.fromOffset,s=n.toOffset,a=n.from,l=n.to,c=t.root.getSelection(),u=null,f=c.anchorNode;if(f&&t.dom.contains(f.nodeType==1?f:f.parentNode)&&(u=[{node:f,offset:c.anchorOffset}],Xt(c)||u.push({node:c.focusNode,offset:c.focusOffset})),p.chrome&&t.lastKeyCode===8)for(var h=s;h>i;h--){var d=o.childNodes[h-1],m=d.pmViewDesc;if(d.nodeName=="BR"&&!m){s=h;break}if(!m||m.size)break}var y=t.state.doc,O=t.someProp("domParser")||Re.fromSchema(t.state.schema),v=y.resolve(a),g=null,S=O.parse(o,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:i,to:s,preserveWhitespace:v.parent.type.whitespace=="pre"?"full":!0,editableContent:!0,findPositions:u,ruleFromNode:rn,context:v});if(u&&u[0].pos!=null){var b=u[0].pos,D=u[1]&&u[1].pos;D==null&&(D=b),g={anchor:b+a,head:D+a}}return{doc:S,sel:g,from:a,to:l}}function rn(t){var e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(p.safari&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||p.safari&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0}}function nn(t,e,r,n,o){if(e<0){var i=t.lastSelectionTime>Date.now()-50?t.lastSelectionOrigin:null,s=je(t,i);if(s&&!t.state.selection.eq(s)){var a=t.state.tr.setSelection(s);i=="pointer"?a.setMeta("pointer",!0):i=="key"&&a.scrollIntoView(),t.dispatch(a)}return}var l=t.state.doc.resolve(e),c=l.sharedDepth(r);e=l.before(c+1),r=t.state.doc.resolve(r).after(c+1);var u=t.state.selection,f=en(t,e,r);if(p.chrome&&t.cursorWrapper&&f.sel&&f.sel.anchor==t.cursorWrapper.deco.from){var h=t.cursorWrapper.deco.type.toDOM.nextSibling,d=h&&h.nodeValue?h.nodeValue.length:1;f.sel={anchor:f.sel.anchor+d,head:f.sel.anchor+d}}var m=t.state.doc,y=m.slice(f.from,f.to),O,v;t.lastKeyCode===8&&Date.now()-100<t.lastKeyCodeTime?(O=t.state.selection.to,v="end"):(O=t.state.selection.from,v="start"),t.lastKeyCode=null;var g=an(y.content,f.doc.content,f.from,O,v);if(!g)if(n&&u instanceof F&&!u.empty&&u.$head.sameParent(u.$anchor)&&!t.composing&&!(f.sel&&f.sel.anchor!=f.sel.head))g={start:u.from,endA:u.to,endB:u.to};else if((p.ios&&t.lastIOSEnter>Date.now()-225||p.android)&&o.some(function(P){return P.nodeName=="DIV"||P.nodeName=="P"})&&t.someProp("handleKeyDown",function(P){return P(t,ft(13,"Enter"))})){t.lastIOSEnter=0;return}else{if(f.sel){var S=Te(t,t.state.doc,f.sel);S&&!S.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(S))}return}t.domChangeCount++,t.state.selection.from<t.state.selection.to&&g.start==g.endB&&t.state.selection instanceof F&&(g.start>t.state.selection.from&&g.start<=t.state.selection.from+2&&t.state.selection.from>=f.from?g.start=t.state.selection.from:g.endA<t.state.selection.to&&g.endA>=t.state.selection.to-2&&t.state.selection.to<=f.to&&(g.endB+=t.state.selection.to-g.endA,g.endA=t.state.selection.to)),p.ie&&p.ie_version<=11&&g.endB==g.start+1&&g.endA==g.start&&g.start>f.from&&f.doc.textBetween(g.start-f.from-1,g.start-f.from+1)==" \xA0"&&(g.start--,g.endA--,g.endB--);var b=f.doc.resolveNoCache(g.start-f.from),D=f.doc.resolveNoCache(g.endB-f.from),M=b.sameParent(D)&&b.parent.inlineContent,U;if((p.ios&&t.lastIOSEnter>Date.now()-225&&(!M||o.some(function(P){return P.nodeName=="DIV"||P.nodeName=="P"}))||!M&&b.pos<f.doc.content.size&&(U=vt.findFrom(f.doc.resolve(b.pos+1),1,!0))&&U.head==D.pos)&&t.someProp("handleKeyDown",function(P){return P(t,ft(13,"Enter"))})){t.lastIOSEnter=0;return}if(t.state.selection.anchor>g.start&&sn(m,g.start,g.endA,b,D)&&t.someProp("handleKeyDown",function(P){return P(t,ft(8,"Backspace"))})){p.android&&p.chrome&&t.domObserver.suppressSelectionUpdates();return}p.chrome&&p.android&&g.toB==g.from&&(t.lastAndroidDelete=Date.now()),p.android&&!M&&b.start()!=D.start()&&D.parentOffset==0&&b.depth==D.depth&&f.sel&&f.sel.anchor==f.sel.head&&f.sel.head==g.endA&&(g.endB-=2,D=f.doc.resolveNoCache(g.endB-f.from),setTimeout(function(){t.someProp("handleKeyDown",function(P){return P(t,ft(13,"Enter"))})},20));var T=g.start,V=g.endA,I,et,rt,nt;if(M){if(b.pos==D.pos)p.ie&&p.ie_version<=11&&b.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(function(){return tt(t)},20)),I=t.state.tr.delete(T,V),et=m.resolve(g.start).marksAcross(m.resolve(g.endA));else if(g.endA==g.endB&&(nt=m.resolve(g.start))&&(rt=on(b.parent.content.cut(b.parentOffset,D.parentOffset),nt.parent.content.cut(nt.parentOffset,g.endA-nt.start()))))I=t.state.tr,rt.type=="add"?I.addMark(T,V,rt.mark):I.removeMark(T,V,rt.mark);else if(b.parent.child(b.index()).isText&&b.index()==D.index()-(D.textOffset?0:1)){var Nt=b.parent.textBetween(b.parentOffset,D.parentOffset);if(t.someProp("handleTextInput",function(P){return P(t,T,V,Nt)}))return;I=t.state.tr.insertText(Nt,T,V)}}if(I||(I=t.state.tr.replace(T,V,f.doc.slice(g.start-f.from,g.endB-f.from))),f.sel){var R=Te(t,I.doc,f.sel);R&&!(p.chrome&&p.android&&t.composing&&R.empty&&(g.start!=g.endB||t.lastAndroidDelete<Date.now()-100)&&(R.head==T||R.head==I.mapping.map(V)-1)||p.ie&&R.empty&&R.head==T)&&I.setSelection(R)}et&&I.ensureMarks(et),t.dispatch(I.scrollIntoView())}function Te(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:wt(t,e.resolve(r.anchor),e.resolve(r.head))}function on(t,e){for(var r=t.firstChild.marks,n=e.firstChild.marks,o=r,i=n,s,a,l,c=0;c<n.length;c++)o=n[c].removeFromSet(o);for(var u=0;u<r.length;u++)i=r[u].removeFromSet(i);if(o.length==1&&i.length==0)a=o[0],s="add",l=function(d){return d.mark(a.addToSet(d.marks))};else if(o.length==0&&i.length==1)a=i[0],s="remove",l=function(d){return d.mark(a.removeFromSet(d.marks))};else return null;for(var f=[],h=0;h<e.childCount;h++)f.push(l(e.child(h)));if(Q.from(f).eq(t))return{mark:a,type:s}}function sn(t,e,r,n,o){if(!n.parent.isTextblock||r-e<=o.pos-n.pos||Wt(n,!0,!1)<o.pos)return!1;var i=t.resolve(e);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=t.resolve(Wt(i,!0,!0));return!s.parent.isTextblock||s.pos>r||Wt(s,!0,!1)<r?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function Wt(t,e,r){for(var n=t.depth,o=e?t.end():t.pos;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,o++,e=!1;if(r)for(var i=t.node(n).maybeChild(t.indexAfter(n));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function an(t,e,r,n,o){var i=t.findDiffStart(e,r);if(i==null)return null;var s=t.findDiffEnd(e,r+t.size,r+e.size),a=s.a,l=s.b;if(o=="end"){var c=Math.max(0,i-Math.min(a,l));n-=a+c-i}if(a<i&&t.size<e.size){var u=n<=i&&n>=a?i-n:0;i-=u,l=i+(l-a),a=i}else if(l<i){var f=n<=i&&n>=l?i-n:0;i-=f,a=i+(a-l),l=i}return{start:i,endA:a,endB:l}}function $e(t,e){for(var r=[],n=e.content,o=e.openStart,i=e.openEnd;o>1&&i>1&&n.childCount==1&&n.firstChild.childCount==1;){o--,i--;var s=n.firstChild;r.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),n=s.content}var a=t.someProp("clipboardSerializer")||Tt.fromSchema(t.state.schema),l=or(),c=l.createElement("div");c.appendChild(a.serializeFragment(n,{document:l}));for(var u=c.firstChild,f;u&&u.nodeType==1&&(f=nr[u.nodeName.toLowerCase()]);){for(var h=f.length-1;h>=0;h--){for(var d=l.createElement(f[h]);c.firstChild;)d.appendChild(c.firstChild);c.appendChild(d),f[h]!="tbody"&&(o++,i++)}u=c.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(r));var m=t.someProp("clipboardTextSerializer",function(y){return y(e)})||e.content.textBetween(0,e.content.size,`

`);return{dom:c,text:m}}function we(t,e,r,n,o){var i,s=o.parent.type.spec.code,a;if(!r&&!e)return null;var l=e&&(n||s||!r);if(l){if(t.someProp("transformPastedText",function(D){e=D(e,s||n)}),s)return e?new $(Q.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):$.empty;var c=t.someProp("clipboardTextParser",function(D){return D(e,o,n)});if(c)a=c;else{var u=o.marks(),f=t.state,h=f.schema,d=Tt.fromSchema(h);i=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(D){var M=i.appendChild(document.createElement("p"));D&&M.appendChild(d.serializeNode(h.text(D,u)))})}}else t.someProp("transformPastedHTML",function(D){r=D(r)}),i=fn(r),p.webkit&&un(i);var m=i&&i.querySelector("[data-pm-slice]"),y=m&&/^(\d+) (\d+) (.*)/.exec(m.getAttribute("data-pm-slice"));if(!a){var O=t.someProp("clipboardParser")||t.someProp("domParser")||Re.fromSchema(t.state.schema);a=O.parseSlice(i,{preserveWhitespace:!!(l||y),context:o,ruleFromNode:function(M){if(M.nodeName=="BR"&&!M.nextSibling&&M.parentNode&&!ln.test(M.parentNode.nodeName))return{ignore:!0}}})}if(y)a=hn(Ae(a,+y[1],+y[2]),y[3]);else if(a=$.maxOpen(cn(a.content,o),!0),a.openStart||a.openEnd){for(var v=0,g=0,S=a.content.firstChild;v<a.openStart&&!S.type.spec.isolating;v++,S=S.firstChild);for(var b=a.content.lastChild;g<a.openEnd&&!b.type.spec.isolating;g++,b=b.lastChild);a=Ae(a,v,g)}return t.someProp("transformPasted",function(D){a=D(a)}),a}var ln=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function cn(t,e){if(t.childCount<2)return t;for(var r=function(i){var s=e.node(i),a=s.contentMatchAt(e.index(i)),l=void 0,c=[];if(t.forEach(function(u){if(!!c){var f=a.findWrapping(u.type),h;if(!f)return c=null;if(h=c.length&&l.length&&er(f,l,u,c[c.length-1],0))c[c.length-1]=h;else{c.length&&(c[c.length-1]=rr(c[c.length-1],l.length));var d=tr(u,f);c.push(d),a=a.matchType(d.type,d.attrs),l=f}}}),c)return{v:Q.from(c)}},n=e.depth;n>=0;n--){var o=r(n);if(o)return o.v}return t}function tr(t,e,r){r===void 0&&(r=0);for(var n=e.length-1;n>=r;n--)t=e[n].create(null,Q.from(t));return t}function er(t,e,r,n,o){if(o<t.length&&o<e.length&&t[o]==e[o]){var i=er(t,e,r,n.lastChild,o+1);if(i)return n.copy(n.content.replaceChild(n.childCount-1,i));var s=n.contentMatchAt(n.childCount);if(s.matchType(o==t.length-1?r.type:t[o+1]))return n.copy(n.content.append(Q.from(tr(r,t,o+1))))}}function rr(t,e){if(e==0)return t;var r=t.content.replaceChild(t.childCount-1,rr(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(Q.empty,!0);return t.copy(r.append(n))}function jt(t,e,r,n,o,i){var s=e<0?t.firstChild:t.lastChild,a=s.content;return o<n-1&&(a=jt(a,e,r,n,o+1,i)),o>=r&&(a=e<0?s.contentMatchAt(0).fillBefore(a,t.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(Q.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function Ae(t,e,r){return e<t.openStart&&(t=new $(jt(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new $(jt(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}var nr={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Pe=null;function or(){return Pe||(Pe=document.implementation.createHTMLDocument("title"))}function fn(t){var e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var r=or().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),o;if((o=n&&nr[n[1].toLowerCase()])&&(t=o.map(function(s){return"<"+s+">"}).join("")+t+o.map(function(s){return"</"+s+">"}).reverse().join("")),r.innerHTML=t,o)for(var i=0;i<o.length;i++)r=r.querySelector(o[i])||r;return r}function un(t){for(var e=t.querySelectorAll(p.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),r=0;r<e.length;r++){var n=e[r];n.childNodes.length==1&&n.textContent=="\xA0"&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function hn(t,e){if(!t.size)return t;var r=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}for(var o=t.content,i=t.openStart,s=t.openEnd,a=n.length-2;a>=0;a-=2){var l=r.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;o=Q.from(l.create(n[a+1],o)),i++,s++}return new $(o,i,s)}var dn={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},ee=p.ie&&p.ie_version<=11,re=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};re.prototype.set=function(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset};re.prototype.eq=function(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset};var L=function(e,r){var n=this;this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(o){for(var i=0;i<o.length;i++)n.queue.push(o[i]);p.ie&&p.ie_version<=11&&o.some(function(s){return s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length})?n.flushSoon():n.flush()}),this.currentSelection=new re,ee&&(this.onCharData=function(o){n.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};L.prototype.flushSoon=function(){var e=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){e.flushingSoon=-1,e.flush()},20))};L.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};L.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,dn),ee&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};L.prototype.stop=function(){var e=this;if(this.observer){var r=this.observer.takeRecords();if(r.length){for(var n=0;n<r.length;n++)this.queue.push(r[n]);window.setTimeout(function(){return e.flush()},20)}this.observer.disconnect()}ee&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};L.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};L.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};L.prototype.suppressSelectionUpdates=function(){var e=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return e.suppressingSelectionUpdates=!1},50)};L.prototype.onSelectionChange=function(){if(!!Zr(this.view)){if(this.suppressingSelectionUpdates)return tt(this.view);if(p.ie&&p.ie_version<=11&&!this.view.state.selection.empty){var e=this.view.root.getSelection();if(e.focusNode&&bt(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}};L.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};L.prototype.ignoreSelectionChange=function(e){if(e.rangeCount==0)return!0;var r=e.getRangeAt(0).commonAncestorContainer,n=this.view.docView.nearestDesc(r);if(n&&n.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0};L.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);var r=this.view.root.getSelection(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&te(this.view)&&!this.ignoreSelectionChange(r),o=-1,i=-1,s=!1,a=[];if(this.view.editable)for(var l=0;l<e.length;l++){var c=this.registerMutation(e[l],a);c&&(o=o<0?c.from:Math.min(c.from,o),i=i<0?c.to:Math.max(c.to,i),c.typeOver&&(s=!0))}if(p.gecko&&a.length>1){var u=a.filter(function(d){return d.nodeName=="BR"});if(u.length==2){var f=u[0],h=u[1];f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}}(o>-1||n)&&(o>-1&&(this.view.docView.markDirty(o,i),pn(this.view)),this.handleDOMChange(o,i,s,a),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(r)||tt(this.view),this.currentSelection.set(r))}};L.prototype.registerMutation=function(e,r){if(r.indexOf(e.target)>-1)return null;var n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(var o=0;o<e.addedNodes.length;o++)r.push(e.addedNodes[o]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};var i=e.previousSibling,s=e.nextSibling;if(p.ie&&p.ie_version<=11&&e.addedNodes.length)for(var a=0;a<e.addedNodes.length;a++){var l=e.addedNodes[a],c=l.previousSibling,u=l.nextSibling;(!c||Array.prototype.indexOf.call(e.addedNodes,c)<0)&&(i=c),(!u||Array.prototype.indexOf.call(e.addedNodes,u)<0)&&(s=u)}var f=i&&i.parentNode==e.target?_(i)+1:0,h=n.localPosFromDOM(e.target,f,-1),d=s&&s.parentNode==e.target?_(s):e.target.childNodes.length,m=n.localPosFromDOM(e.target,d,1);return{from:h,to:m}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}};var Ee=!1;function pn(t){Ee||(Ee=!0,getComputedStyle(t.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var z={},B={};function mn(t){t.shiftKey=!1,t.mouseDown=null,t.lastKeyCode=null,t.lastKeyCodeTime=0,t.lastClick={time:0,x:0,y:0,type:""},t.lastSelectionOrigin=null,t.lastSelectionTime=0,t.lastIOSEnter=0,t.lastIOSEnterFallbackTimeout=null,t.lastAndroidDelete=0,t.composing=!1,t.composingTimeout=null,t.compositionNodes=[],t.compositionEndedAt=-2e8,t.domObserver=new L(t,function(n,o,i,s){return nn(t,n,o,i,s)}),t.domObserver.start(),t.domChangeCount=0,t.eventHandlers=Object.create(null);var e=function(n){var o=z[n];t.dom.addEventListener(n,t.eventHandlers[n]=function(i){yn(t,i)&&!oe(t,i)&&(t.editable||!(i.type in B))&&o(t,i)})};for(var r in z)e(r);p.safari&&t.dom.addEventListener("input",function(){return null}),ne(t)}function st(t,e){t.lastSelectionOrigin=e,t.lastSelectionTime=Date.now()}function gn(t){t.domObserver.stop();for(var e in t.eventHandlers)t.dom.removeEventListener(e,t.eventHandlers[e]);clearTimeout(t.composingTimeout),clearTimeout(t.lastIOSEnterFallbackTimeout)}function ne(t){t.someProp("handleDOMEvents",function(e){for(var r in e)t.eventHandlers[r]||t.dom.addEventListener(r,t.eventHandlers[r]=function(n){return oe(t,n)})})}function oe(t,e){return t.someProp("handleDOMEvents",function(r){var n=r[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function yn(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function vn(t,e){!oe(t,e)&&z[e.type]&&(t.editable||!(e.type in B))&&z[e.type](t,e)}B.keydown=function(t,e){if(t.shiftKey=e.keyCode==16||e.shiftKey,!sr(t,e)&&(t.lastKeyCode=e.keyCode,t.lastKeyCodeTime=Date.now(),!(p.android&&p.chrome&&e.keyCode==13)))if(e.keyCode!=229&&t.domObserver.forceFlush(),p.ios&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){var r=Date.now();t.lastIOSEnter=r,t.lastIOSEnterFallbackTimeout=setTimeout(function(){t.lastIOSEnter==r&&(t.someProp("handleKeyDown",function(n){return n(t,ft(13,"Enter"))}),t.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",function(n){return n(t,e)})||tn(t,e)?e.preventDefault():st(t,"key")};B.keyup=function(t,e){e.keyCode==16&&(t.shiftKey=!1)};B.keypress=function(t,e){if(!(sr(t,e)||!e.charCode||e.ctrlKey&&!e.altKey||p.mac&&e.metaKey)){if(t.someProp("handleKeyPress",function(o){return o(t,e)})){e.preventDefault();return}var r=t.state.selection;if(!(r instanceof F)||!r.$from.sameParent(r.$to)){var n=String.fromCharCode(e.charCode);t.someProp("handleTextInput",function(o){return o(t,r.$from.pos,r.$to.pos,n)})||t.dispatch(t.state.tr.insertText(n).scrollIntoView()),e.preventDefault()}}};function Pt(t){return{left:t.clientX,top:t.clientY}}function bn(t,e){var r=e.x-t.clientX,n=e.y-t.clientY;return r*r+n*n<100}function ie(t,e,r,n,o){if(n==-1)return!1;for(var i=t.state.doc.resolve(n),s=function(c){if(t.someProp(e,function(u){return c>i.depth?u(t,r,i.nodeAfter,i.before(c),o,!0):u(t,r,i.node(c),i.before(c),o,!1)}))return{v:!0}},a=i.depth+1;a>0;a--){var l=s(a);if(l)return l.v}return!1}function ut(t,e,r){t.focused||t.focus();var n=t.state.tr.setSelection(e);r=="pointer"&&n.setMeta("pointer",!0),t.dispatch(n)}function Dn(t,e){if(e==-1)return!1;var r=t.state.doc.resolve(e),n=r.nodeAfter;return n&&n.isAtom&&k.isSelectable(n)?(ut(t,new k(r),"pointer"),!0):!1}function On(t,e){if(e==-1)return!1;var r=t.state.selection,n,o;r instanceof k&&(n=r.node);for(var i=t.state.doc.resolve(e),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(k.isSelectable(a)){n&&r.$from.depth>0&&s>=r.$from.depth&&i.before(r.$from.depth+1)==r.$from.pos?o=i.before(r.$from.depth):o=i.before(s);break}}return o!=null?(ut(t,k.create(t.state.doc,o),"pointer"),!0):!1}function Cn(t,e,r,n,o){return ie(t,"handleClickOn",e,r,n)||t.someProp("handleClick",function(i){return i(t,e,n)})||(o?On(t,r):Dn(t,r))}function Nn(t,e,r,n){return ie(t,"handleDoubleClickOn",e,r,n)||t.someProp("handleDoubleClick",function(o){return o(t,e,n)})}function Sn(t,e,r,n){return ie(t,"handleTripleClickOn",e,r,n)||t.someProp("handleTripleClick",function(o){return o(t,e,n)})||Mn(t,r,n)}function Mn(t,e,r){if(r.button!=0)return!1;var n=t.state.doc;if(e==-1)return n.inlineContent?(ut(t,F.create(n,0,n.content.size),"pointer"),!0):!1;for(var o=n.resolve(e),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)ut(t,F.create(n,a+1,a+1+s.content.size),"pointer");else if(k.isSelectable(s))ut(t,k.create(n,a),"pointer");else continue;return!0}}function se(t){return Mt(t)}var ir=p.mac?"metaKey":"ctrlKey";z.mousedown=function(t,e){t.shiftKey=e.shiftKey;var r=se(t),n=Date.now(),o="singleClick";n-t.lastClick.time<500&&bn(e,t.lastClick)&&!e[ir]&&(t.lastClick.type=="singleClick"?o="doubleClick":t.lastClick.type=="doubleClick"&&(o="tripleClick")),t.lastClick={time:n,x:e.clientX,y:e.clientY,type:o};var i=t.posAtCoords(Pt(e));!i||(o=="singleClick"?(t.mouseDown&&t.mouseDown.done(),t.mouseDown=new Et(t,i,e,r)):(o=="doubleClick"?Nn:Sn)(t,i.pos,i.inside,e)?e.preventDefault():st(t,"pointer"))};var Et=function(e,r,n,o){var i=this;this.view=e,this.startDoc=e.state.doc,this.pos=r,this.event=n,this.flushed=o,this.selectNode=n[ir],this.allowDefault=n.shiftKey,this.delayedSelectionSync=!1;var s,a;if(r.inside>-1)s=e.state.doc.nodeAt(r.inside),a=r.inside;else{var l=e.state.doc.resolve(r.pos);s=l.parent,a=l.depth?l.before():0}this.mightDrag=null;var c=o?null:n.target,u=c?e.docView.nearestDesc(c,!0):null;this.target=u?u.dom:null;var f=e.state,h=f.selection;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||h instanceof k&&h.from<=a&&h.to>a)&&(this.mightDrag={node:s,pos:a,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&p.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){i.view.mouseDown==i&&i.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),st(e,"pointer")};Et.prototype.done=function(){var e=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return tt(e.view)}),this.view.mouseDown=null};Et.prototype.up=function(e){if(this.done(),!!this.view.dom.contains(e.target.nodeType==3?e.target.parentNode:e.target)){var r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(Pt(e))),this.allowDefault||!r?st(this.view,"pointer"):Cn(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||p.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||p.chrome&&!(this.view.state.selection instanceof F)&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(ut(this.view,vt.near(this.view.state.doc.resolve(r.pos)),"pointer"),e.preventDefault()):st(this.view,"pointer")}};Et.prototype.move=function(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),st(this.view,"pointer"),e.buttons==0&&this.done()};z.touchdown=function(t){se(t),st(t,"pointer")};z.contextmenu=function(t){return se(t)};function sr(t,e){return t.composing?!0:p.safari&&Math.abs(e.timeStamp-t.compositionEndedAt)<500?(t.compositionEndedAt=-2e8,!0):!1}var kn=p.android?5e3:-1;B.compositionstart=B.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,r=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(function(a){return a.type.spec.inclusive===!1})))t.markCursor=t.state.storedMarks||r.marks(),Mt(t,!0),t.markCursor=null;else if(Mt(t),p.gecko&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length)for(var n=t.root.getSelection(),o=n.focusNode,i=n.focusOffset;o&&o.nodeType==1&&i!=0;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(s.nodeType==3){n.collapse(s,s.nodeValue.length);break}else o=s,i=-1}t.composing=!0}ar(t,kn)};B.compositionend=function(t,e){t.composing&&(t.composing=!1,t.compositionEndedAt=e.timeStamp,ar(t,20))};function ar(t,e){clearTimeout(t.composingTimeout),e>-1&&(t.composingTimeout=setTimeout(function(){return Mt(t)},e))}function lr(t){for(t.composing&&(t.composing=!1,t.compositionEndedAt=Tn());t.compositionNodes.length>0;)t.compositionNodes.pop().markParentsDirty()}function Tn(){var t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Mt(t,e){if(!(p.android&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),lr(t),e||t.docView&&t.docView.dirty){var r=je(t);return r&&!r.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(r)):t.updateState(t.state),!0}return!1}}function An(t,e){if(!!t.dom.parentNode){var r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";var n=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(o),setTimeout(function(){r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}}var ht=p.ie&&p.ie_version<15||p.ios&&p.webkit_version<604;z.copy=B.cut=function(t,e){var r=t.state.selection,n=e.type=="cut";if(!r.empty){var o=ht?null:e.clipboardData,i=r.content(),s=$e(t,i),a=s.dom,l=s.text;o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",l)):An(t,a),n&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function Pn(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function En(t,e){if(!!t.dom.parentNode){var r=t.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(function(){t.focus(),n.parentNode&&n.parentNode.removeChild(n),r?Qt(t,n.value,null,e):Qt(t,n.textContent,n.innerHTML,e)},50)}}function Qt(t,e,r,n){var o=we(t,e,r,t.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",function(a){return a(t,n,o||$.empty)}))return!0;if(!o)return!1;var i=Pn(o),s=i?t.state.tr.replaceSelectionWith(i,t.shiftKey):t.state.tr.replaceSelection(o);return t.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}B.paste=function(t,e){if(!(t.composing&&!p.android)){var r=ht?null:e.clipboardData;r&&Qt(t,r.getData("text/plain"),r.getData("text/html"),e)?e.preventDefault():En(t,e)}};var xn=function(e,r){this.slice=e,this.move=r},cr=p.mac?"altKey":"ctrlKey";z.dragstart=function(t,e){var r=t.mouseDown;if(r&&r.done(),!!e.dataTransfer){var n=t.state.selection,o=n.empty?null:t.posAtCoords(Pt(e));if(!(o&&o.pos>=n.from&&o.pos<=(n instanceof k?n.to-1:n.to))){if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(k.create(t.state.doc,r.mightDrag.pos)));else if(e.target&&e.target.nodeType==1){var i=t.docView.nearestDesc(e.target,!0);i&&i.node.type.spec.draggable&&i!=t.docView&&t.dispatch(t.state.tr.setSelection(k.create(t.state.doc,i.posBefore)))}}var s=t.state.selection.content(),a=$e(t,s),l=a.dom,c=a.text;e.dataTransfer.clearData(),e.dataTransfer.setData(ht?"Text":"text/html",l.innerHTML),e.dataTransfer.effectAllowed="copyMove",ht||e.dataTransfer.setData("text/plain",c),t.dragging=new xn(s,!e[cr])}};z.dragend=function(t){var e=t.dragging;window.setTimeout(function(){t.dragging==e&&(t.dragging=null)},50)};B.dragover=B.dragenter=function(t,e){return e.preventDefault()};B.drop=function(t,e){var r=t.dragging;if(t.dragging=null,!!e.dataTransfer){var n=t.posAtCoords(Pt(e));if(!!n){var o=t.state.doc.resolve(n.pos);if(!!o){var i=r&&r.slice;i?t.someProp("transformPasted",function(m){i=m(i)}):i=we(t,e.dataTransfer.getData(ht?"Text":"text/plain"),ht?null:e.dataTransfer.getData("text/html"),!1,o);var s=r&&!e[cr];if(t.someProp("handleDrop",function(m){return m(t,e,i||$.empty,s)})){e.preventDefault();return}if(!!i){e.preventDefault();var a=i?Dr(t.state.doc,o.pos,i):o.pos;a==null&&(a=o.pos);var l=t.state.tr;s&&l.deleteSelection();var c=l.mapping.map(a),u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(u?l.replaceRangeWith(c,c,i.content.firstChild):l.replaceRange(c,c,i),!l.doc.eq(f)){var h=l.doc.resolve(c);if(u&&k.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new k(h));else{var d=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach(function(m,y,O,v){return d=v}),l.setSelection(wt(t,h,l.doc.resolve(d)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}}}}}};z.focus=function(t){t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.root.getSelection())&&tt(t)},20))};z.blur=function(t,e){t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),e.relatedTarget&&t.dom.contains(e.relatedTarget)&&t.domObserver.currentSelection.set({}),t.focused=!1)};z.beforeinput=function(t,e){if(p.chrome&&p.android&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();var r=t.domChangeCount;setTimeout(function(){if(t.domChangeCount==r&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",function(i){return i(t,ft(8,"Backspace"))}))){var n=t.state.selection,o=n.$cursor;o&&o.pos>0&&t.dispatch(t.state.tr.delete(o.pos-1,o.pos).scrollIntoView())}},50)}};for(var xe in B)z[xe]=B[xe];function Dt(t,e){if(t==e)return!0;for(var r in t)if(t[r]!==e[r])return!1;for(var n in e)if(!(n in t))return!1;return!0}var dt=function(e,r){this.spec=r||at,this.side=this.spec.side||0,this.toDOM=e};dt.prototype.map=function(e,r,n,o){var i=e.mapResult(r.from+o,this.side<0?-1:1),s=i.pos,a=i.deleted;return a?null:new E(s-n,s-n,this)};dt.prototype.valid=function(){return!0};dt.prototype.eq=function(e){return this==e||e instanceof dt&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Dt(this.spec,e.spec))};dt.prototype.destroy=function(e){this.spec.destroy&&this.spec.destroy(e)};var H=function(e,r){this.spec=r||at,this.attrs=e};H.prototype.map=function(e,r,n,o){var i=e.map(r.from+o,this.spec.inclusiveStart?-1:1)-n,s=e.map(r.to+o,this.spec.inclusiveEnd?1:-1)-n;return i>=s?null:new E(i,s,this)};H.prototype.valid=function(e,r){return r.from<r.to};H.prototype.eq=function(e){return this==e||e instanceof H&&Dt(this.attrs,e.attrs)&&Dt(this.spec,e.spec)};H.is=function(e){return e.type instanceof H};var Ot=function(e,r){this.spec=r||at,this.attrs=e};Ot.prototype.map=function(e,r,n,o){var i=e.mapResult(r.from+o,1);if(i.deleted)return null;var s=e.mapResult(r.to+o,-1);return s.deleted||s.pos<=i.pos?null:new E(i.pos-n,s.pos-n,this)};Ot.prototype.valid=function(e,r){var n=e.content.findIndex(r.from),o=n.index,i=n.offset,s;return i==r.from&&!(s=e.child(o)).isText&&i+s.nodeSize==r.to};Ot.prototype.eq=function(e){return this==e||e instanceof Ot&&Dt(this.attrs,e.attrs)&&Dt(this.spec,e.spec)};var E=function(e,r,n){this.from=e,this.to=r,this.type=n},ae={spec:{configurable:!0},inline:{configurable:!0}};E.prototype.copy=function(e,r){return new E(e,r,this.type)};E.prototype.eq=function(e,r){return r===void 0&&(r=0),this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to};E.prototype.map=function(e,r,n){return this.type.map(e,this,r,n)};E.widget=function(e,r,n){return new E(e,e,new dt(r,n))};E.inline=function(e,r,n,o){return new E(e,r,new H(n,o))};E.node=function(e,r,n,o){return new E(e,r,new Ot(n,o))};ae.spec.get=function(){return this.type.spec};ae.inline.get=function(){return this.type instanceof H};Object.defineProperties(E.prototype,ae);var kt=[],at={},C=function(e,r){this.local=e&&e.length?e:kt,this.children=r&&r.length?r:kt};C.create=function(e,r){return r.length?xt(r,e,0,at):x};C.prototype.find=function(e,r,n){var o=[];return this.findInner(e==null?0:e,r==null?1e9:r,o,0,n),o};C.prototype.findInner=function(e,r,n,o,i){for(var s=0;s<this.local.length;s++){var a=this.local[s];a.from<=r&&a.to>=e&&(!i||i(a.spec))&&n.push(a.copy(a.from+o,a.to+o))}for(var l=0;l<this.children.length;l+=3)if(this.children[l]<r&&this.children[l+1]>e){var c=this.children[l]+1;this.children[l+2].findInner(e-c,r-c,n,o+c,i)}};C.prototype.map=function(e,r,n){return this==x||e.maps.length==0?this:this.mapInner(e,r,0,0,n||at)};C.prototype.mapInner=function(e,r,n,o,i){for(var s,a=0;a<this.local.length;a++){var l=this.local[a].map(e,n,o);l&&l.type.valid(r,l)?(s||(s=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?Vn(this.children,s,e,r,n,o,i):s?new C(s.sort(lt)):x};C.prototype.add=function(e,r){return r.length?this==x?C.create(e,r):this.addInner(e,r,0):this};C.prototype.addInner=function(e,r,n){var o=this,i,s=0;e.forEach(function(c,u){var f=u+n,h;if(!!(h=ur(r,c,f))){for(i||(i=o.children.slice());s<i.length&&i[s]<u;)s+=3;i[s]==u?i[s+2]=i[s+2].addInner(c,h,f+1):i.splice(s,0,u,u+c.nodeSize,xt(h,c,f+1,at)),s+=3}});for(var a=fr(s?hr(r):r,-n),l=0;l<a.length;l++)a[l].type.valid(e,a[l])||a.splice(l--,1);return new C(a.length?this.local.concat(a).sort(lt):this.local,i||this.children)};C.prototype.remove=function(e){return e.length==0||this==x?this:this.removeInner(e,0)};C.prototype.removeInner=function(e,r){for(var n=this.children,o=this.local,i=0;i<n.length;i+=3){for(var s=void 0,a=n[i]+r,l=n[i+1]+r,c=0,u=void 0;c<e.length;c++)(u=e[c])&&u.from>a&&u.to<l&&(e[c]=null,(s||(s=[])).push(u));if(!!s){n==this.children&&(n=this.children.slice());var f=n[i+2].removeInner(s,a+1);f!=x?n[i+2]=f:(n.splice(i,3),i-=3)}}if(o.length){for(var h=0,d=void 0;h<e.length;h++)if(d=e[h])for(var m=0;m<o.length;m++)o[m].eq(d,r)&&(o==this.local&&(o=this.local.slice()),o.splice(m--,1))}return n==this.children&&o==this.local?this:o.length||n.length?new C(o,n):x};C.prototype.forChild=function(e,r){if(this==x)return this;if(r.isLeaf)return C.empty;for(var n,o,i=0;i<this.children.length;i+=3)if(this.children[i]>=e){this.children[i]==e&&(n=this.children[i+2]);break}for(var s=e+1,a=s+r.content.size,l=0;l<this.local.length;l++){var c=this.local[l];if(c.from<a&&c.to>s&&c.type instanceof H){var u=Math.max(s,c.from)-s,f=Math.min(a,c.to)-s;u<f&&(o||(o=[])).push(c.copy(u,f))}}if(o){var h=new C(o.sort(lt));return n?new q([h,n]):h}return n||x};C.prototype.eq=function(e){if(this==e)return!0;if(!(e instanceof C)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(var n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0};C.prototype.locals=function(e){return le(this.localsInner(e))};C.prototype.localsInner=function(e){if(this==x)return kt;if(e.inlineContent||!this.local.some(H.is))return this.local;for(var r=[],n=0;n<this.local.length;n++)this.local[n].type instanceof H||r.push(this.local[n]);return r};var x=new C;C.empty=x;C.removeOverlap=le;var q=function(e){this.members=e};q.prototype.map=function(e,r){var n=this.members.map(function(o){return o.map(e,r,at)});return q.from(n)};q.prototype.forChild=function(e,r){if(r.isLeaf)return C.empty;for(var n=[],o=0;o<this.members.length;o++){var i=this.members[o].forChild(e,r);i!=x&&(i instanceof q?n=n.concat(i.members):n.push(i))}return q.from(n)};q.prototype.eq=function(e){if(!(e instanceof q)||e.members.length!=this.members.length)return!1;for(var r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0};q.prototype.locals=function(e){for(var r,n=!0,o=0;o<this.members.length;o++){var i=this.members[o].localsInner(e);if(!!i.length)if(!r)r=i;else{n&&(r=r.slice(),n=!1);for(var s=0;s<i.length;s++)r.push(i[s])}}return r?le(n?r:r.sort(lt)):kt};q.from=function(e){switch(e.length){case 0:return x;case 1:return e[0];default:return new q(e)}};function Vn(t,e,r,n,o,i,s){for(var a=t.slice(),l=function(et,rt,nt,Nt){for(var R=0;R<a.length;R+=3){var P=a[R+1],Rt=void 0;if(!(P<0||et>P+i)){var fe=a[R]+i;rt>=fe?a[R+1]=et<=fe?-2:-1:nt>=o&&(Rt=Nt-nt-(rt-et))&&(a[R]+=Rt,a[R+1]+=Rt)}}},c=0;c<r.maps.length;c++)r.maps[c].forEach(l);for(var u=!1,f=0;f<a.length;f+=3)if(a[f+1]<0){if(a[f+1]==-2){u=!0,a[f+1]=-1;continue}var h=r.map(t[f]+i),d=h-o;if(d<0||d>=n.content.size){u=!0;continue}var m=r.map(t[f+1]+i,-1),y=m-o,O=n.content.findIndex(d),v=O.index,g=O.offset,S=n.maybeChild(v);if(S&&g==d&&g+S.nodeSize==y){var b=a[f+2].mapInner(r,S,h+1,t[f]+i+1,s);b!=x?(a[f]=d,a[f+1]=y,a[f+2]=b):(a[f+1]=-2,u=!0)}else u=!0}if(u){var D=Rn(a,t,e||[],r,o,i,s),M=xt(D,n,0,s);e=M.local;for(var U=0;U<a.length;U+=3)a[U+1]<0&&(a.splice(U,3),U-=3);for(var T=0,V=0;T<M.children.length;T+=3){for(var I=M.children[T];V<a.length&&a[V]<I;)V+=3;a.splice(V,0,M.children[T],M.children[T+1],M.children[T+2])}}return new C(e&&e.sort(lt),a)}function fr(t,e){if(!e||!t.length)return t;for(var r=[],n=0;n<t.length;n++){var o=t[n];r.push(new E(o.from+e,o.to+e,o.type))}return r}function Rn(t,e,r,n,o,i,s){function a(c,u){for(var f=0;f<c.local.length;f++){var h=c.local[f].map(n,o,u);h?r.push(h):s.onRemove&&s.onRemove(c.local[f].spec)}for(var d=0;d<c.children.length;d+=3)a(c.children[d+2],c.children[d]+u+1)}for(var l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return r}function ur(t,e,r){if(e.isLeaf)return null;for(var n=r+e.nodeSize,o=null,i=0,s=void 0;i<t.length;i++)(s=t[i])&&s.from>r&&s.to<n&&((o||(o=[])).push(s),t[i]=null);return o}function hr(t){for(var e=[],r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function xt(t,e,r,n){var o=[],i=!1;e.forEach(function(l,c){var u=ur(t,l,c+r);if(u){i=!0;var f=xt(u,l,r+c+1,n);f!=x&&o.push(c,c+l.nodeSize,f)}});for(var s=fr(i?hr(t):t,-r).sort(lt),a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(n.onRemove&&n.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new C(s,o):x}function lt(t,e){return t.from-e.from||t.to-e.to}function le(t){for(var e=t,r=0;r<e.length-1;r++){var n=e[r];if(n.from!=n.to)for(var o=r+1;o<e.length;o++){var i=e[o];if(i.from==n.from){i.to!=n.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,n.to),Ve(e,o+1,i.copy(n.to,i.to)));continue}else{i.from<n.to&&(e==t&&(e=t.slice()),e[r]=n.copy(n.from,i.from),Ve(e,o,n.copy(i.from,n.to)));break}}}return e}function Ve(t,e,r){for(;e<t.length&&lt(r,t[e])>0;)e++;t.splice(e,0,r)}function ce(t){var e=[];return t.someProp("decorations",function(r){var n=r(t.state);n&&n!=x&&e.push(n)}),t.cursorWrapper&&e.push(C.create(t.state.doc,[t.cursorWrapper.deco])),q.from(e)}var A=function(e,r){this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(yr),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):e.apply?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=mr(this),this.markCursor=null,this.cursorWrapper=null,pr(this),this.nodeViews=gr(this),this.docView=We(this.state.doc,dr(this),ce(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,mn(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},Vt={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};Vt.props.get=function(){if(this._props.state!=this.state){var t=this._props;this._props={};for(var e in t)this._props[e]=t[e];this._props.state=this.state}return this._props};A.prototype.update=function(e){e.handleDOMEvents!=this._props.handleDOMEvents&&ne(this),this._props=e,e.plugins&&(e.plugins.forEach(yr),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)};A.prototype.setProps=function(e){var r={};for(var n in this._props)r[n]=this._props[n];r.state=this.state;for(var o in e)r[o]=e[o];this.update(r)};A.prototype.updateState=function(e){this.updateStateInner(e,this.state.plugins!=e.plugins)};A.prototype.updateStateInner=function(e,r){var n=this,o=this.state,i=!1,s=!1;if(e.storedMarks&&this.composing&&(lr(this),s=!0),this.state=e,r){var a=gr(this);In(a,this.nodeViews)&&(this.nodeViews=a,i=!0),ne(this)}this.editable=mr(this),pr(this);var l=ce(this),c=dr(this),u=r?"reset":e.scrollToSelection>o.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(e.doc,c,l);(f||!e.selection.eq(o.selection))&&(s=!0);var h=u=="preserve"&&s&&this.dom.style.overflowAnchor==null&&kr(this);if(s){this.domObserver.stop();var d=f&&(p.ie||p.chrome)&&!this.composing&&!o.selection.empty&&!e.selection.empty&&Bn(o.selection,e.selection);if(f){var m=p.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(i||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=We(e.doc,c,l,this.dom,this)),m&&!this.trackWrites&&(d=!0)}d||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&Xr(this))?tt(this,d):(Ze(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(o),u=="reset")this.dom.scrollTop=0;else if(u=="to selection"){var y=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(O){return O(n)})||(e.selection instanceof k?pe(this,this.docView.domAfterPos(e.selection.from).getBoundingClientRect(),y):pe(this,this.coordsAtPos(e.selection.head,1),y))}else h&&Tr(h)};A.prototype.destroyPluginViews=function(){for(var e;e=this.pluginViews.pop();)e.destroy&&e.destroy()};A.prototype.updatePluginViews=function(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var r=0;r<this.directPlugins.length;r++){var n=this.directPlugins[r];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(var o=0;o<this.state.plugins.length;o++){var i=this.state.plugins[o];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}else for(var s=0;s<this.pluginViews.length;s++){var a=this.pluginViews[s];a.update&&a.update(this,e)}};A.prototype.someProp=function(e,r){var n=this._props&&this._props[e],o;if(n!=null&&(o=r?r(n):n))return o;for(var i=0;i<this.directPlugins.length;i++){var s=this.directPlugins[i].props[e];if(s!=null&&(o=r?r(s):s))return o}var a=this.state.plugins;if(a)for(var l=0;l<a.length;l++){var c=a[l].props[e];if(c!=null&&(o=r?r(c):c))return o}};A.prototype.hasFocus=function(){return this.root.activeElement==this.dom};A.prototype.focus=function(){this.domObserver.stop(),this.editable&&Ar(this.dom),tt(this),this.domObserver.start()};Vt.root.get=function(){var t=this._root;if(t==null){for(var e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e}return t||document};A.prototype.posAtCoords=function(e){return Rr(this,e)};A.prototype.coordsAtPos=function(e,r){return r===void 0&&(r=1),_e(this,e,r)};A.prototype.domAtPos=function(e,r){return r===void 0&&(r=0),this.docView.domFromPos(e,r)};A.prototype.nodeDOM=function(e){var r=this.docView.descAt(e);return r?r.nodeDOM:null};A.prototype.posAtDOM=function(e,r,n){n===void 0&&(n=-1);var o=this.docView.posFromDOM(e,r,n);if(o==null)throw new RangeError("DOM position not inside the editor");return o};A.prototype.endOfTextblock=function(e,r){return _r(this,r||this.state,e)};A.prototype.destroy=function(){!this.docView||(gn(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],ce(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};Vt.isDestroyed.get=function(){return this.docView==null};A.prototype.dispatchEvent=function(e){return vn(this,e)};A.prototype.dispatch=function(e){var r=this._props.dispatchTransaction;r?r.call(this,e):this.updateState(this.state.apply(e))};Object.defineProperties(A.prototype,Vt);function dr(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",function(r){if(typeof r=="function"&&(r=r(t.state)),r)for(var n in r)n=="class"&&(e.class+=" "+r[n]),n=="style"?e.style=(e.style?e.style+";":"")+r[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(r[n]))}),[E.node(0,t.state.doc.content.size,e)]}function pr(t){if(t.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:E.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function mr(t){return!t.someProp("editable",function(e){return e(t.state)===!1})}function Bn(t,e){var r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function gr(t){var e={};return t.someProp("nodeViews",function(r){for(var n in r)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=r[n])}),e}function In(t,e){var r=0,n=0;for(var o in t){if(t[o]!=e[o])return!0;r++}for(var i in e)n++;return r!=n}function yr(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}export{C as D,A as E,E as a};
