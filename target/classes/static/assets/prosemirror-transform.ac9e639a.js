import{F as v,a as l,d as st,R as ft}from"./prosemirror-model.b56130c8.js";var j=65535,$=Math.pow(2,16);function ht(i,t){return i+t*$}function tt(i){return i&j}function ct(i){return(i-(i&j))/$}var q=function(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=null),this.pos=t,this.deleted=e,this.recover=r},w=function i(t,e){if(e===void 0&&(e=!1),!t.length&&i.empty)return i.empty;this.ranges=t,this.inverted=e};w.prototype.recover=function(t){var e=0,r=tt(t);if(!this.inverted)for(var n=0;n<r;n++)e+=this.ranges[n*3+2]-this.ranges[n*3+1];return this.ranges[r*3]+e+ct(t)};w.prototype.mapResult=function(t,e){return e===void 0&&(e=1),this._map(t,e,!1)};w.prototype.map=function(t,e){return e===void 0&&(e=1),this._map(t,e,!0)};w.prototype._map=function(t,e,r){for(var n=0,o=this.inverted?2:1,a=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var s=this.ranges[p]-(this.inverted?n:0);if(s>t)break;var f=this.ranges[p+o],c=this.ranges[p+a],h=s+f;if(t<=h){var u=f?t==s?-1:t==h?1:e:e,d=s+n+(u<0?0:c);if(r)return d;var m=t==(e<0?s:h)?null:ht(p/3,t-s);return new q(d,e<0?t!=s:t!=h,m)}n+=c-f}return r?t+n:new q(t+n)};w.prototype.touches=function(t,e){for(var r=0,n=tt(e),o=this.inverted?2:1,a=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var s=this.ranges[p]-(this.inverted?r:0);if(s>t)break;var f=this.ranges[p+o],c=s+f;if(t<=c&&p==n*3)return!0;r+=this.ranges[p+a]-f}return!1};w.prototype.forEach=function(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,n=0,o=0;n<this.ranges.length;n+=3){var a=this.ranges[n],p=a-(this.inverted?o:0),s=a+(this.inverted?0:o),f=this.ranges[n+e],c=this.ranges[n+r];t(p,p+f,s,s+c),o+=c-f}};w.prototype.invert=function(){return new w(this.ranges,!this.inverted)};w.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};w.offset=function(t){return t==0?w.empty:new w(t<0?[0,-t,0]:[0,0,t])};w.empty=new w([]);var k=function(t,e,r,n){this.maps=t||[],this.from=r||0,this.to=n==null?this.maps.length:n,this.mirror=e};k.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.maps.length),new k(this.maps,this.mirror,t,e)};k.prototype.copy=function(){return new k(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};k.prototype.appendMap=function(t,e){this.to=this.maps.push(t),e!=null&&this.setMirror(this.maps.length-1,e)};k.prototype.appendMapping=function(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var n=t.getMirror(e);this.appendMap(t.maps[e],n!=null&&n<e?r+n:null)}};k.prototype.getMirror=function(t){if(this.mirror){for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}};k.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)};k.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var n=t.getMirror(e);this.appendMap(t.maps[e].invert(),n!=null&&n>e?r-n-1:null)}};k.prototype.invert=function(){var t=new k;return t.appendMappingInverted(this),t};k.prototype.map=function(t,e){if(e===void 0&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t};k.prototype.mapResult=function(t,e){return e===void 0&&(e=1),this._map(t,e,!1)};k.prototype._map=function(t,e,r){for(var n=!1,o=this.from;o<this.to;o++){var a=this.maps[o],p=a.mapResult(t,e);if(p.recover!=null){var s=this.getMirror(o);if(s!=null&&s>o&&s<this.to){o=s,t=this.maps[s].recover(p.recover);continue}}p.deleted&&(n=!0),t=p.pos}return r?t:new q(t,n)};function J(i){var t=Error.call(this,i);return t.__proto__=J.prototype,t}J.prototype=Object.create(Error.prototype);J.prototype.constructor=J;J.prototype.name="TransformError";var g=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new k},P={before:{configurable:!0},docChanged:{configurable:!0}};P.before.get=function(){return this.docs.length?this.docs[0]:this.doc};g.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new J(e.failed);return this};g.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e};P.docChanged.get=function(){return this.steps.length>0};g.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e};Object.defineProperties(g.prototype,P);function W(){throw new Error("Override me")}var G=Object.create(null),S=function(){};S.prototype.apply=function(t){return W()};S.prototype.getMap=function(){return w.empty};S.prototype.invert=function(t){return W()};S.prototype.map=function(t){return W()};S.prototype.merge=function(t){return null};S.prototype.toJSON=function(){return W()};S.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=G[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)};S.jsonID=function(t,e){if(t in G)throw new RangeError("Duplicate use of step JSON ID "+t);return G[t]=e,e.prototype.jsonID=t,e};var M=function(t,e){this.doc=t,this.failed=e};M.ok=function(t){return new M(t,null)};M.fail=function(t){return new M(null,t)};M.fromReplace=function(t,e,r,n){try{return M.ok(t.replace(e,r,n))}catch(o){if(o instanceof ft)return M.fail(o.message);throw o}};var O=function(i){function t(e,r,n,o){i.call(this),this.from=e,this.to=r,this.slice=n,this.structure=!!o}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){return this.structure&&H(r,this.from,this.to)?M.fail("Structure replace would overwrite content"):M.fromReplace(r,this.from,this.to,this.slice)},t.prototype.getMap=function(){return new w([this.from,this.to-this.from,this.slice.size])},t.prototype.invert=function(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))},t.prototype.map=function(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return n.deleted&&o.deleted?null:new t(n.pos,Math.max(n.pos,o.pos),this.slice)},t.prototype.merge=function(r){if(!(r instanceof t)||r.structure||this.structure)return null;if(this.from+this.slice.size==r.from&&!this.slice.openEnd&&!r.slice.openStart){var n=this.slice.size+r.slice.size==0?l.empty:new l(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),n,this.structure)}else if(r.to==this.from&&!this.slice.openStart&&!r.slice.openEnd){var o=this.slice.size+r.slice.size==0?l.empty:new l(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,o,this.structure)}else return null},t.prototype.toJSON=function(){var r={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(n.from,n.to,l.fromJSON(r,n.slice),!!n.structure)},t}(S);S.jsonID("replace",O);var z=function(i){function t(e,r,n,o,a,p,s){i.call(this),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=o,this.slice=a,this.insert=p,this.structure=!!s}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){if(this.structure&&(H(r,this.from,this.gapFrom)||H(r,this.gapTo,this.to)))return M.fail("Structure gap-replace would overwrite content");var n=r.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return M.fail("Gap is not a flat range");var o=this.slice.insertAt(this.insert,n.content);return o?M.fromReplace(r,this.from,this.to,o):M.fail("Content does not fit in gap")},t.prototype.getMap=function(){return new w([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},t.prototype.invert=function(r){var n=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},t.prototype.map=function(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1),a=r.map(this.gapFrom,-1),p=r.map(this.gapTo,1);return n.deleted&&o.deleted||a<n.pos||p>o.pos?null:new t(n.pos,o.pos,a,p,this.slice,this.insert,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(n.from,n.to,n.gapFrom,n.gapTo,l.fromJSON(r,n.slice),n.insert,!!n.structure)},t}(S);S.jsonID("replaceAround",z);function H(i,t,e){for(var r=i.resolve(t),n=e-t,o=r.depth;n>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,n--;if(n>0)for(var a=r.node(o).maybeChild(r.indexAfter(o));n>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,n--}return!1}function ut(i,t,e){return(t==0||i.canReplace(t,i.childCount))&&(e==i.childCount||i.canReplace(0,e))}function kt(i){for(var t=i.parent,e=t.content.cutByIndex(i.startIndex,i.endIndex),r=i.depth;;--r){var n=i.$from.node(r),o=i.$from.index(r),a=i.$to.indexAfter(r);if(r<i.depth&&n.canReplace(o,a,e))return r;if(r==0||n.type.spec.isolating||!ut(n,o,a))break}}g.prototype.lift=function(i,t){for(var e=i.$from,r=i.$to,n=i.depth,o=e.before(n+1),a=r.after(n+1),p=o,s=a,f=v.empty,c=0,h=n,u=!1;h>t;h--)u||e.index(h)>0?(u=!0,f=v.from(e.node(h).copy(f)),c++):p--;for(var d=v.empty,m=0,y=n,R=!1;y>t;y--)R||r.after(y+1)<r.end(y)?(R=!0,d=v.from(r.node(y).copy(d)),m++):s++;return this.step(new z(p,s,o,a,new l(f.append(d),c,m),f.size-c,!0))};function Rt(i,t,e,r){r===void 0&&(r=i);var n=lt(i,t),o=n&&vt(r,t);return o?n.map(Z).concat({type:t,attrs:e}).concat(o.map(Z)):null}function Z(i){return{type:i,attrs:null}}function lt(i,t){var e=i.parent,r=i.startIndex,n=i.endIndex,o=e.contentMatchAt(r).findWrapping(t);if(!o)return null;var a=o.length?o[0]:t;return e.canReplaceWith(r,n,a)?o:null}function vt(i,t){var e=i.parent,r=i.startIndex,n=i.endIndex,o=e.child(r),a=t.contentMatch.findWrapping(o.type);if(!a)return null;for(var p=a.length?a[a.length-1]:t,s=p.contentMatch,f=r;s&&f<n;f++)s=s.matchType(e.child(f).type);return!s||!s.validEnd?null:a}g.prototype.wrap=function(i,t){for(var e=v.empty,r=t.length-1;r>=0;r--){if(e.size){var n=t[r].type.contentMatch.matchFragment(e);if(!n||!n.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}e=v.from(t[r].type.create(t[r].attrs,e))}var o=i.start,a=i.end;return this.step(new z(o,a,o,a,new l(e,0,0),t.length,!0))};g.prototype.setBlockType=function(i,t,e,r){var n=this;if(t===void 0&&(t=i),!e.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var o=this.steps.length;return this.doc.nodesBetween(i,t,function(a,p){if(a.isTextblock&&!a.hasMarkup(e,r)&&dt(n.doc,n.mapping.slice(o).map(p),e)){n.clearIncompatible(n.mapping.slice(o).map(p,1),e);var s=n.mapping.slice(o),f=s.map(p,1),c=s.map(p+a.nodeSize,1);return n.step(new z(f,c,f+1,c-1,new l(v.from(e.create(r,null,a.marks)),0,0),1,!0)),!1}}),this};function dt(i,t,e){var r=i.resolve(t),n=r.index();return r.parent.canReplaceWith(n,n+1,e)}g.prototype.setNodeMarkup=function(i,t,e,r){var n=this.doc.nodeAt(i);if(!n)throw new RangeError("No node at given position");t||(t=n.type);var o=t.create(e,null,r||n.marks);if(n.isLeaf)return this.replaceWith(i,i+n.nodeSize,o);if(!t.validContent(n.content))throw new RangeError("Invalid content for node type "+t.name);return this.step(new z(i,i+n.nodeSize,i+1,i+n.nodeSize-1,new l(v.from(o),0,0),1,!0))};function Ct(i,t,e,r){e===void 0&&(e=1);var n=i.resolve(t),o=n.depth-e,a=r&&r[r.length-1]||n.parent;if(o<0||n.parent.type.spec.isolating||!n.parent.canReplace(n.index(),n.parent.childCount)||!a.type.validContent(n.parent.content.cutByIndex(n.index(),n.parent.childCount)))return!1;for(var p=n.depth-1,s=e-2;p>o;p--,s--){var f=n.node(p),c=n.index(p);if(f.type.spec.isolating)return!1;var h=f.content.cutByIndex(c,f.childCount),u=r&&r[s]||f;if(u!=f&&(h=h.replaceChild(0,u.type.create(u.attrs))),!f.canReplace(c+1,f.childCount)||!u.type.validContent(h))return!1}var d=n.indexAfter(o),m=r&&r[0];return n.node(o).canReplaceWith(d,d,m?m.type:n.node(o+1).type)}g.prototype.split=function(i,t,e){t===void 0&&(t=1);for(var r=this.doc.resolve(i),n=v.empty,o=v.empty,a=r.depth,p=r.depth-t,s=t-1;a>p;a--,s--){n=v.from(r.node(a).copy(n));var f=e&&e[s];o=v.from(f?f.type.create(f.attrs,o):r.node(a).copy(o))}return this.step(new O(i,i,new l(n.append(o),t,t),!0))};function bt(i,t){var e=i.resolve(t),r=e.index();return mt(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(r,r+1)}function mt(i,t){return i&&t&&!i.isLeaf&&i.canAppend(t)}g.prototype.join=function(i,t){t===void 0&&(t=1);var e=new O(i-t,i+t,l.empty,!0);return this.step(e)};function yt(i,t,e){var r=i.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),e))return t;if(r.parentOffset==0)for(var n=r.depth-1;n>=0;n--){var o=r.index(n);if(r.node(n).canReplaceWith(o,o,e))return r.before(n+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(var a=r.depth-1;a>=0;a--){var p=r.indexAfter(a);if(r.node(a).canReplaceWith(p,p,e))return r.after(a+1);if(p<r.node(a).childCount)return null}}function Nt(i,t,e){var r=i.resolve(t);if(!e.content.size)return t;for(var n=e.content,o=0;o<e.openStart;o++)n=n.firstChild.content;for(var a=1;a<=(e.openStart==0&&e.size?2:1);a++)for(var p=r.depth;p>=0;p--){var s=p==r.depth?0:r.pos<=(r.start(p+1)+r.end(p+1))/2?-1:1,f=r.index(p)+(s>0?1:0),c=r.node(p),h=!1;if(a==1)h=c.canReplace(f,f,n);else{var u=c.contentMatchAt(f).findWrapping(n.firstChild.type);h=u&&c.canReplaceWith(f,f,u[0])}if(h)return s==0?r.pos:s<0?r.before(p+1):r.after(p+1)}return null}function Q(i,t,e){for(var r=[],n=0;n<i.childCount;n++){var o=i.child(n);o.content.size&&(o=o.copy(Q(o.content,t,o))),o.isInline&&(o=t(o,e,n)),r.push(o)}return v.fromArray(r)}var U=function(i){function t(e,r,n){i.call(this),this.from=e,this.to=r,this.mark=n}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){var n=this,o=r.slice(this.from,this.to),a=r.resolve(this.from),p=a.node(a.sharedDepth(this.to)),s=new l(Q(o.content,function(f,c){return!f.isAtom||!c.type.allowsMarkType(n.mark.type)?f:f.mark(n.mark.addToSet(f.marks))},p),o.openStart,o.openEnd);return M.fromReplace(r,this.from,this.to,s)},t.prototype.invert=function(){return new A(this.from,this.to,this.mark)},t.prototype.map=function(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return n.deleted&&o.deleted||n.pos>=o.pos?null:new t(n.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(n.from,n.to,r.markFromJSON(n.mark))},t}(S);S.jsonID("addMark",U);var A=function(i){function t(e,r,n){i.call(this),this.from=e,this.to=r,this.mark=n}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){var n=this,o=r.slice(this.from,this.to),a=new l(Q(o.content,function(p){return p.mark(n.mark.removeFromSet(p.marks))}),o.openStart,o.openEnd);return M.fromReplace(r,this.from,this.to,a)},t.prototype.invert=function(){return new U(this.from,this.to,this.mark)},t.prototype.map=function(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return n.deleted&&o.deleted||n.pos>=o.pos?null:new t(n.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(n.from,n.to,r.markFromJSON(n.mark))},t}(S);S.jsonID("removeMark",A);g.prototype.addMark=function(i,t,e){var r=this,n=[],o=[],a=null,p=null;return this.doc.nodesBetween(i,t,function(s,f,c){if(!!s.isInline){var h=s.marks;if(!e.isInSet(h)&&c.type.allowsMarkType(e.type)){for(var u=Math.max(f,i),d=Math.min(f+s.nodeSize,t),m=e.addToSet(h),y=0;y<h.length;y++)h[y].isInSet(m)||(a&&a.to==u&&a.mark.eq(h[y])?a.to=d:n.push(a=new A(u,d,h[y])));p&&p.to==u?p.to=d:o.push(p=new U(u,d,e))}}}),n.forEach(function(s){return r.step(s)}),o.forEach(function(s){return r.step(s)}),this};g.prototype.removeMark=function(i,t,e){var r=this;e===void 0&&(e=null);var n=[],o=0;return this.doc.nodesBetween(i,t,function(a,p){if(!!a.isInline){o++;var s=null;if(e instanceof st)for(var f=a.marks,c;c=e.isInSet(f);)(s||(s=[])).push(c),f=c.removeFromSet(f);else e?e.isInSet(a.marks)&&(s=[e]):s=a.marks;if(s&&s.length)for(var h=Math.min(p+a.nodeSize,t),u=0;u<s.length;u++){for(var d=s[u],m=void 0,y=0;y<n.length;y++){var R=n[y];R.step==o-1&&d.eq(n[y].style)&&(m=R)}m?(m.to=h,m.step=o):n.push({style:d,from:Math.max(p,i),to:h,step:o})}}}),n.forEach(function(a){return r.step(new A(a.from,a.to,a.style))}),this};g.prototype.clearIncompatible=function(i,t,e){e===void 0&&(e=t.contentMatch);for(var r=this.doc.nodeAt(i),n=[],o=i+1,a=0;a<r.childCount;a++){var p=r.child(a),s=o+p.nodeSize,f=e.matchType(p.type,p.attrs);if(!f)n.push(new O(o,s,l.empty));else{e=f;for(var c=0;c<p.marks.length;c++)t.allowsMarkType(p.marks[c].type)||this.step(new A(o,s,p.marks[c]))}o=s}if(!e.validEnd){var h=e.fillBefore(v.empty,!0);this.replace(o,o,new l(h,0,0))}for(var u=n.length-1;u>=0;u--)this.step(n[u]);return this};function gt(i,t,e,r){if(e===void 0&&(e=t),r===void 0&&(r=l.empty),t==e&&!r.size)return null;var n=i.resolve(t),o=i.resolve(e);return et(n,o,r)?new O(t,e,r):new b(n,o,r).fit()}g.prototype.replace=function(i,t,e){t===void 0&&(t=i),e===void 0&&(e=l.empty);var r=gt(this.doc,i,t,e);return r&&this.step(r),this};g.prototype.replaceWith=function(i,t,e){return this.replace(i,t,new l(v.from(e),0,0))};g.prototype.delete=function(i,t){return this.replace(i,t,l.empty)};g.prototype.insert=function(i,t){return this.replaceWith(i,i,t)};function et(i,t,e){return!e.openStart&&!e.openEnd&&i.start()==t.start()&&i.parent.canReplace(i.index(),t.index(),e.content)}var b=function(t,e,r){this.$to=e,this.$from=t,this.unplaced=r,this.frontier=[];for(var n=0;n<=t.depth;n++){var o=t.node(n);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(n))})}this.placed=v.empty;for(var a=t.depth;a>0;a--)this.placed=v.from(t.node(a).copy(this.placed))},rt={depth:{configurable:!0}};rt.depth.get=function(){return this.frontier.length-1};b.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,n=this.$from,o=this.close(e<0?this.$to:n.doc.resolve(e));if(!o)return null;for(var a=this.placed,p=n.depth,s=o.depth;p&&s&&a.childCount==1;)a=a.firstChild.content,p--,s--;var f=new l(a,p,s);if(e>-1)return new z(n.pos,e,this.$to.pos,this.$to.end(),f,r);if(f.size||n.pos!=this.$to.pos)return new O(n.pos,o.pos,f)};b.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var r=void 0,n=void 0;e?(n=V(this.unplaced.content,e-1).firstChild,r=n.content):r=this.unplaced.content;for(var o=r.firstChild,a=this.depth;a>=0;a--){var p=this.frontier[a],s=p.type,f=p.match,c=void 0,h=void 0;if(t==1&&(o?f.matchType(o.type)||(h=f.fillBefore(v.from(o),!1)):s.compatibleContent(n.type)))return{sliceDepth:e,frontierDepth:a,parent:n,inject:h};if(t==2&&o&&(c=f.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:a,parent:n,wrap:c};if(n&&f.matchType(n.type))break}}};b.prototype.openMore=function(){var t=this.unplaced,e=t.content,r=t.openStart,n=t.openEnd,o=V(e,r);return!o.childCount||o.firstChild.isLeaf?!1:(this.unplaced=new l(e,r+1,Math.max(n,o.size+r>=e.size-n?r+1:0)),!0)};b.prototype.dropNode=function(){var t=this.unplaced,e=t.content,r=t.openStart,n=t.openEnd,o=V(e,r);if(o.childCount<=1&&r>0){var a=e.size-r<=r+o.size;this.unplaced=new l(_(e,r-1,1),r-1,a?r-1:n)}else this.unplaced=new l(_(e,r,1),r,n)};b.prototype.placeNodes=function(t){for(var e=t.sliceDepth,r=t.frontierDepth,n=t.parent,o=t.inject,a=t.wrap;this.depth>r;)this.closeFrontierNode();if(a)for(var p=0;p<a.length;p++)this.openFrontierNode(a[p]);var s=this.unplaced,f=n?n.content:s.content,c=s.openStart-e,h=0,u=[],d=this.frontier[r],m=d.match,y=d.type;if(o){for(var R=0;R<o.childCount;R++)u.push(o.child(R));m=m.matchFragment(o)}for(var N=f.size+e-(s.content.size-s.openEnd);h<f.childCount;){var x=f.child(h),T=m.matchType(x.type);if(!T)break;h++,(h>1||c==0||x.content.size)&&(m=T,u.push(nt(x.mark(y.allowedMarks(x.marks)),h==1?c:0,h==f.childCount?N:-1)))}var I=h==f.childCount;I||(N=-1),this.placed=B(this.placed,r,v.from(u)),this.frontier[r].match=m,I&&N<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var E=0,F=f;E<N;E++){var C=F.lastChild;this.frontier.push({type:C.type,match:C.contentMatchAt(C.childCount)}),F=C.content}this.unplaced=I?e==0?l.empty:new l(_(s.content,e-1,1),e-1,N<0?s.openEnd:e-1):new l(_(s.content,e,h),s.openStart,s.openEnd)};b.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t=this.frontier[this.depth],e;if(!t.type.isTextblock||!K(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;for(var r=this.$to,n=r.depth,o=this.$to.after(n);n>1&&o==this.$to.end(--n);)++o;return o};b.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],n=r.match,o=r.type,a=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),p=K(t,e,o,n,a);if(!!p){for(var s=e-1;s>=0;s--){var f=this.frontier[s],c=f.match,h=f.type,u=K(t,s,h,c,!0);if(!u||u.childCount)continue t}return{depth:e,fit:p,move:a?t.doc.resolve(t.after(e+1)):t}}}};b.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=B(this.placed,e.depth,e.fit)),t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var n=t.node(r),o=n.type.contentMatch.fillBefore(n.content,!0,t.index(r));this.openFrontierNode(n.type,n.attrs,o)}return t};b.prototype.openFrontierNode=function(t,e,r){var n=this.frontier[this.depth];n.match=n.match.matchType(t),this.placed=B(this.placed,this.depth,v.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})};b.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(v.empty,!0);e.childCount&&(this.placed=B(this.placed,this.frontier.length,e))};Object.defineProperties(b.prototype,rt);function _(i,t,e){return t==0?i.cutByIndex(e):i.replaceChild(0,i.firstChild.copy(_(i.firstChild.content,t-1,e)))}function B(i,t,e){return t==0?i.append(e):i.replaceChild(i.childCount-1,i.lastChild.copy(B(i.lastChild.content,t-1,e)))}function V(i,t){for(var e=0;e<t;e++)i=i.firstChild.content;return i}function nt(i,t,e){if(t<=0)return i;var r=i.content;return t>1&&(r=r.replaceChild(0,nt(r.firstChild,t-1,r.childCount==1?e-1:0))),t>0&&(r=i.type.contentMatch.fillBefore(r).append(r),e<=0&&(r=r.append(i.type.contentMatch.matchFragment(r).fillBefore(v.empty,!0)))),i.copy(r)}function K(i,t,e,r,n){var o=i.node(t),a=n?i.indexAfter(t):i.index(t);if(a==o.childCount&&!e.compatibleContent(o.type))return null;var p=r.fillBefore(o.content,!0,a);return p&&!wt(e,o.content,a)?p:null}function wt(i,t,e){for(var r=e;r<t.childCount;r++)if(!i.allowsMarks(t.child(r).marks))return!0;return!1}function St(i){return i.spec.defining||i.spec.definingForContent}g.prototype.replaceRange=function(i,t,e){if(!e.size)return this.deleteRange(i,t);var r=this.doc.resolve(i),n=this.doc.resolve(t);if(et(r,n,e))return this.step(new O(i,t,e));var o=ot(r,this.doc.resolve(t));o[o.length-1]==0&&o.pop();var a=-(r.depth+1);o.unshift(a);for(var p=r.depth,s=r.pos-1;p>0;p--,s--){var f=r.node(p).type.spec;if(f.defining||f.definingAsContext||f.isolating)break;o.indexOf(p)>-1?a=p:r.before(p)==s&&o.splice(1,0,-p)}for(var c=o.indexOf(a),h=[],u=e.openStart,d=e.content,m=0;;m++){var y=d.firstChild;if(h.push(y),m==e.openStart)break;d=y.content}for(var R=u-1;R>=0;R--){var N=h[R].type,x=St(N);if(x&&r.node(c).type!=N)u=R;else if(x||!N.isTextblock)break}for(var T=e.openStart;T>=0;T--){var I=(T+u+1)%(e.openStart+1),E=h[I];if(!!E)for(var F=0;F<o.length;F++){var C=o[(F+c)%o.length],X=!0;C<0&&(X=!1,C=-C);var at=r.node(C-1),Y=r.index(C-1);if(at.canReplaceWith(Y,Y,E.type,E.marks))return this.replace(r.before(C),X?n.after(C):t,new l(it(e.content,0,e.openStart,I),I,e.openEnd))}}for(var pt=this.steps.length,L=o.length-1;L>=0&&(this.replace(i,t,e),!(this.steps.length>pt));L--){var D=o[L];D<0||(i=r.before(D),t=n.after(D))}return this};function it(i,t,e,r,n){if(t<e){var o=i.firstChild;i=i.replaceChild(0,o.copy(it(o.content,t+1,e,r,o)))}if(t>r){var a=n.contentMatchAt(0),p=a.fillBefore(i).append(i);i=p.append(a.matchFragment(p).fillBefore(v.empty,!0))}return i}g.prototype.replaceRangeWith=function(i,t,e){if(!e.isInline&&i==t&&this.doc.resolve(i).parent.content.size){var r=yt(this.doc,i,e.type);r!=null&&(i=t=r)}return this.replaceRange(i,t,new l(v.from(e),0,0))};g.prototype.deleteRange=function(i,t){for(var e=this.doc.resolve(i),r=this.doc.resolve(t),n=ot(e,r),o=0;o<n.length;o++){var a=n[o],p=o==n.length-1;if(p&&a==0||e.node(a).type.contentMatch.validEnd)return this.delete(e.start(a),r.end(a));if(a>0&&(p||e.node(a-1).canReplace(e.index(a-1),r.indexAfter(a-1))))return this.delete(e.before(a),r.after(a))}for(var s=1;s<=e.depth&&s<=r.depth;s++)if(i-e.start(s)==e.depth-s&&t>e.end(s)&&r.end(s)-t!=r.depth-s)return this.delete(e.before(s),t);return this.delete(i,t)};function ot(i,t){for(var e=[],r=Math.min(i.depth,t.depth),n=r;n>=0;n--){var o=i.start(n);if(o<i.pos-(i.depth-n)||t.end(n)>t.pos+(t.depth-n)||i.node(n).type.spec.isolating||t.node(n).type.spec.isolating)break;(o==t.start(n)||n==i.depth&&n==t.depth&&i.parent.inlineContent&&t.parent.inlineContent&&n&&t.start(n-1)==o-1)&&e.push(n)}return e}export{k as M,z as R,w as S,g as T,O as a,bt as b,Ct as c,Nt as d,Rt as f,kt as l,gt as r};
